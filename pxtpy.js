var pxt,__spreadArrays=this&&this.__spreadArrays||function(){for(var e=0,n=0,r=arguments.length;n<r;n++)e+=arguments[n].length;var t=Array(e),i=0;for(n=0;n<r;n++)for(var a=arguments[n],o=0,s=a.length;o<s;o++,i++)t[i]=a[o];return t};!function(e){var n,r;n=e.py||(e.py={}),(r=n.VarModifier||(n.VarModifier={}))[r.NonLocal=0]="NonLocal",r[r.Global=1]="Global",n.isIndex=function(e){return"Index"===e.kind},n.isSubscript=function(e){return"Subscript"===e.kind}}(pxt||(pxt={})),function(Ze){!function(q){var B,G,b,z,Q,j,V,W=Ze.blocks,h=0,r=0,H=0,s="???",t=!1,u=void 0,$=void 0;function o(e){return null==e}function c(e){return null!=e}function v(e){return Ze.tickEvent("python.todo",{kind:e.kind}),W.mkStmt(W.mkText("TODO: "+e.kind))}function l(e){return Ze.tickEvent("python.todo",{kind:e.kind}),W.mkText(" {TODO: "+e.kind+"} ")}var N=y({primType:"string"}),f=y({primType:"number"}),i=y({primType:"boolean"}),S=y({primType:"void"}),p=y({primType:"any"}),J=void 0,m={str:N,string:N,number:f,boolean:i,void:S,any:p};function X(e){var n=Ze.U.flatClone(e);return delete n.pyAST,delete n.pyInstanceType,delete n.pyRetType,delete n.pySymbolType,delete n.moduleTypeMarker,delete n.declared,n.parameters&&(n.parameters=n.parameters.map(function(e){return delete(e=Ze.U.flatClone(e)).pyType,e})),n}function Y(e){if("("==e[0]&&Ze.U.endsWith(e,")"))return Y(e.slice(1,-1));var n=e.indexOf(" => ");if(0<n){var r=e.slice(n+4);if(-1==r.indexOf(")[]")){var t=Y(r),i=e.slice(1,n-1);return g(t,(i?i.split(/, /):[]).map(function(e){return Y(e.replace(/\w+\??: /,""))}))}}if(Ze.U.endsWith(e,"[]"))return k(Y(e.slice(0,-2)));if("_py.Array"===e)return k(p);var a=Ze.U.lookup(m,e);if(a)return a;if(!!e&&!isNaN(e))return f;if("T"==e||"U"==e)return y({primType:"'"+e});var o=d(e+"@type")||d(e);return o?7==o.kind?f:8==o.kind||9==o.kind?o.pyInstanceType||y({classType:o}):6==o.kind?f:(Z(null,9502,Ze.U.lf("'{0}' is not a type near '{1}'",e,s||"???")),y({primType:e})):(Z(null,9501,Ze.U.lf("unknown type '{0}' near '{1}'",e,s||"???")),y({primType:e}))}function E(e){return e.attributes.shim&&"@"==e.attributes.shim[0]}function C(e){if(!e.pySymbolType){if(s=e.pyQName,e.parameters){E(e)&&(e.parameters=[{name:"literal",description:"",type:"string",options:{}}]);for(var n=0,r=e.parameters;n<r.length;n++){var t=r[n];t.pyType||(t.pyType=Y(t.type))}}var i=e.pyRetType;if(ce(e)?e.pyRetType=y({moduleType:e}):e.retType?e.pyRetType=Y(e.retType):e.pyRetType||(Ze.U.oops("no type for: "+e.pyQName),e.pyRetType=y({})),i&&R(e.pyAST,i,e.pyRetType),3==e.kind||1==e.kind){var a=e.parameters.map(function(e){return e.pyType});if(a.some(o))return Z(null,9526,Ze.U.lf("function symbol is missing parameter types near '{1}'",s||"???")),y({});e.pySymbolType=g(e.pyRetType,a.filter(c))}else e.pySymbolType=e.pyRetType;8!=e.kind&&9!=e.kind||(e.pyInstanceType=y({classType:e})),s=void 0}return e.pySymbolType}function d(e){return Ze.U.lookup(G,e)||Ze.U.lookup(B,e)}function U(e){if(e){var n=d(e);return n&&C(n),n}}function y(e){void 0===e&&(e={});var n=Ze.U.flatClone(e);return n.tid=++r,n}function k(e){return y({primType:"@array",typeArgs:[e]})}function g(e,n){return y({primType:"@fn"+n.length,typeArgs:[e].concat(n)})}function A(){return b.currFun||b.currClass||b.currModule}function x(){for(var e=A();e&&e.parent;)e=e.parent;return e}function w(){return"main"==b.currModule.name&&!b.currFun&&!b.currClass}function P(e,n,r,t){var i;t||(t=A());var a=t.vars[e],o=null===(i=a)||void 0===i?void 0:i.symbol;if(!o){var s=_(t);s&&(s+=".");var u=s+e;a={symbol:o=!re(t)||r!==q.VarModifier.Global&&r!==q.VarModifier.NonLocal?re(t)?ee(4,e):ne(4,u):ne(4,e),modifier:r},t.vars[e]=a}for(var l=0,f=Object.keys(n);l<f.length;l++){var c=f[l];o[c]=n[c]}return a}function I(e){return e.union?(e.union=I(e.union),e.union):e}function _(e){var n=e,r="";n.parent&&"FunctionDef"!==n.parent.kind&&"AsyncFunctionDef"!==n.parent.kind&&((r=_(n.parent))?r+=".":r="");var t=e;return"Module"==e.kind&&"main"==t.name?"":t.name?r+t.name:r+"?"+e.kind}function K(e){var n=Ze.U.lookup(xe,e);if(n)return n;for(var r=0,t=Ze.U.values(b.currModule.vars);r<t.length;r++){var i=t[r].symbol;if(i.isImport){if(i.expandsTo==e)return i.pyName||Z(null,9553,lf("missing pyName")),i.pyName;if(i.isImport&&Ze.U.startsWith(e,(i.expandsTo||"")+"."))return i.pyName+e.slice(i.expandsTo.length)}}return e}function L(e){var n=function(e){return t?e:""};return(e=I(e)).primType?e.typeArgs&&"@array"==e.primType?L(e.typeArgs[0])+"[]":Ze.U.startsWith(e.primType,"@fn")&&e.typeArgs?"("+e.typeArgs.slice(1).map(function(e){return"_: "+L(e)}).join(", ")+") => "+L(e.typeArgs[0]):e.primType+n("/P"):e.classType&&e.classType.pyQName?K(e.classType.pyQName)+n("/C"):e.moduleType&&e.moduleType.pyQName?K(e.moduleType.pyQName)+n("/M"):"?"+e.tid}function Z(e,n,r){var t,i,a,o;Q.push((t=e,i=pxtc.DiagnosticCategory.Error,a=n,o=r,t||(t=u),t&&b&&b.currModule?{fileName:z,start:t.startPos,length:t.endPos-t.startPos,line:void 0,column:void 0,code:a,category:i,messageText:o}:{fileName:z,start:0,length:0,line:void 0,column:void 0,code:a,category:i,messageText:o}))}function F(e){return e.primType?e.primType:e.classType?e.classType:e.moduleType?(e.moduleType.moduleTypeMarker||(e.moduleType.moduleTypeMarker={}),e.moduleType.moduleTypeMarker):null}function T(e){return!F(I(e))}function D(e,n,r){var t;(n=I(n)).classType!=r&&(T(n)?n.classType=r:R(e,n,(C(t=r),t.pyInstanceType||Z(null,9527,Ze.U.lf("Instance type symbol '{0}' is missing pyInstanceType",t)),t.pyInstanceType)))}function O(e,n){R(e,fe(e),n)}function R(e,n,r){if(n!==r&&(n=I(n))!==(r=I(r))&&!M(n)&&!M(r))if("any"!==n.primType){var t,i,a=F(n),o=F(r);if(a&&o)if(a===o){if(n.union=r,n.typeArgs&&r.typeArgs)for(var s=0;s<Math.min(n.typeArgs.length,r.typeArgs.length);++s)R(e,n.typeArgs[s],r.typeArgs[s]);n.union=r}else t=n,i=r,Z(e,9500,Ze.U.lf("types not compatible: {0} and {1}",L(t),L(i)));else a&&!o?R(e,r,n):(H++,n.union=r)}else n.union=r}function M(e){var n,r;return!!(null===(r=null===(n=e)||void 0===n?void 0:n.primType)||void 0===r?void 0:r.startsWith("'"))}function ee(e,n){var r=/(.*)\.(.*)/.exec(n),t=r?r[2]:n;return{kind:e,name:t,pyName:t,qName:n,pyQName:n,namespace:r?r[1]:"",attributes:{},pyRetType:y()}}function ne(e,n){var r=G[n];return r?(r.kind=e,r):((r=ee(e,n)).pyQName||Z(null,9527,Ze.U.lf("Symbol '{0}' is missing pyQName",n)),G[r.pyQName]=r)}function re(e){for(var n=e;n;){if("FunctionDef"==n.kind)return!0;n=n.parent}return!1}function te(e,n,r){if(!n.symInfo){var t=_(n);Ze.U.endsWith(t,".__init__")&&(t=t.slice(0,-9)+".__constructor"),re(r=r||A())?n.symInfo=ee(e,t):n.symInfo=ne(e,t);var i=n.symInfo;i.pyAST=n,i.pyName||Z(null,9528,Ze.U.lf("Symbol '{0}' is missing pyName",i.qName||i.name)),r.vars[i.pyName]={symbol:i}}return n.symInfo}function ie(e){var n=e.symInfo.qName;return Ze.U.values(G).filter(function(e){return e.namespace==n&&2==e.kind})}function ae(e,n,r,t){void 0===r&&(r=!1),void 0===t&&(t=!1);var i=e.pyQName+"."+n,a=U(i);if(a)return a;if(!t)for(var o=0,s=e.extendsTypes||[];o<s.length;o++){var u;if(u=U(s[o])){u==e&&Ze.U.userError("field lookup loop on: "+u.qName+" / "+n);var l=ae(u,n,!0);if(l)return l}}return!r&&e.pyAST&&"ClassDef"==e.pyAST.kind?((u=ne(2,i)).isInstance=!0,u):null}function oe(e,n,r){void 0===r&&(r=!1);for(var t,i,a,o=fe(e),s=0,u=(t=I(o),__spreadArrays([t.classType],se(t.primType),[t.moduleType]).filter(c));s<u.length;s++){var l=u[s],f=ae(l,n,r);if(f)return!!o.moduleType?f.isInstance&&Z(null,9505,Ze.U.lf("the field '{0}' of '{1}' is not static",n,l.pyQName)):(f.isInstance||Z(null,9504,Ze.U.lf("the field '{0}' of '{1}' is static",n,l.pyQName)),Ie(a=e,"super")&&0==a.args.length?f.isProtected=!0:"Name"==(i=e).kind&&"self"==i.id&&(b.currClass||Z(null,9529,Ze.U.lf("no class context found for {0}",f.pyQName)),f.namespace!=b.currClass.symInfo.qName&&(f.isProtected=!0))),f}return null}function se(e){var n=[];return"@array"==e?n=[d("_py.Array"),d("Array")]:"string"==e&&(n=[d("_py.String"),d("String")]),n.filter(function(e){return!!e})}function a(e){var n=A(),r=Ze.U.lookup(n.vars,e);if(r)return r;for(;n;){var t=Ze.U.lookup(n.vars,e);if(t)return t;for(;(n=n.parent)&&"ClassDef"==n.kind;);}return null}function ue(e){var n;if(!e)return null;var r,t=e.indexOf(".");if(0<t)(r=null===(n=a(e.slice(0,t)))||void 0===n?void 0:n.symbol)&&r.pyQName!=r.pyName&&(e=r.pyQName+e.slice(t));else if(r=a(e))return r;var i=U(e);return i?{symbol:i}:void 0}function le(e){var n;return null===(n=ue(e))||void 0===n?void 0:n.symbol}function fe(e){return e.tsType?I(e.tsType):(e.tsType=y(),e.tsType)}function ce(e){if(!e)return!1;switch(e.kind){case 5:case 9:case 8:case 6:return!0;default:return!1}}function pe(e){var n,r=Ze.U.flatClone(b);try{n=e()}finally{b=r}return n}function me(e,n){return 0==n.length?W.mkText(""):W.mkGroup([W.mkText("/* TODO: "+e+" "),W.mkGroup(n),W.mkText(" */"),W.mkNewLine()])}function de(e){var n=Qe(e.value);return e.arg?W.mkInfix(W.mkText(e.arg),"=",n):W.mkGroup([W.mkText("**"),n])}function ye(e){if(!e)return y();var n=Ae(e);if(n){var r=d(n+"@type")||d(n);if(r){if(C(r),6==r.kind)return f;if(r.pyInstanceType)return r.pyInstanceType}else if(m[n])return m[n];Z(e,9506,Ze.U.lf("cannot find type '{0}'",n))}else{if(q.isSubscript(e))if("List"===Ae(e.value))if(q.isIndex(e.slice))return k(ye(e.slice.value))}return Z(e,9507,Ze.U.lf("invalid type syntax")),y({})}var ve={Sub:1,Div:1,Pow:1,LShift:1,RShift:1,BitOr:1,BitXor:1,BitAnd:1,FloorDiv:1,Mult:1},ke={Add:"+",Sub:"-",Mult:"*",MatMult:"Math.matrixMult",Div:"/",Mod:"%",Pow:"**",LShift:"<<",RShift:">>",BitOr:"|",BitXor:"^",BitAnd:"&",FloorDiv:"Math.idiv",And:"&&",Or:"||",Eq:"==",NotEq:"!=",Lt:"<",LtE:"<=",Gt:">",GtE:">=",Is:"===",IsNot:"!==",In:"py.In",NotIn:"py.NotIn"},ge={Invert:"~",Not:"!",UAdd:"P+",USub:"P-"},xe={"adafruit_bus_device.i2c_device.I2CDevice":"pins.I2CDevice"};function Te(e){b.blockDepth++;var n=W.mkBlock(e.map(je));return b.blockDepth--,n}function he(e){e.vars||(e.vars={},e.parent=A(),e.blockDepth=b.blockDepth)}function Se(e,n){return void 0===n&&(n=!1),"?"==L(e)[0]?n?W.mkText(": any"):W.mkText(""):W.mkText(": "+L(e))}function e(n,e){try{return pe(e)}catch(e){return console.log(e),W.mkStmt(me("conversion failed for "+(n.name||n.kind),[]))}}function be(e){if(!e||!e.pyAST)return!1;if("FunctionDef"!=e.pyAST.kind)return!1;var n=e.pyAST;return!(!n.callers||1!=n.callers.length)&&!n.callers[0].inCalledPosition}function Ne(x,T){return void 0===T&&(T=!1),e(x,function(){var e,n=!!b.currClass&&!b.currFun,r=w(),t=!!b.currFun;he(x);var i=le(_(x)),a=te(n?1:3,x);if(!T&&(i&&i.declared===h&&Z(x,9520,lf("Duplicate function declaration")),a.declared=h,be(a)))return W.mkText("");n&&(a.isInstance=!0),b.currFun=x;var o="",s=x.name,u=[me("decorators",x.decorator_list.filter(function(e){return"property"==Ae(e)?!(o="get"):"Attribute"!=e.kind||"setter"!=e.attr||"Name"!=e.value.kind||(s=e.value.id,!(o="set"))}).map(Qe))];if(1<=x.body.length&&"Raise"==x.body[0].kind&&(x.alwaysThrows=!0),n)if(b.currClass||Z(x,9531,lf("method '{0}' is missing current class context",a.pyQName)),a.pyRetType||Z(x,9532,lf("method '{0}' is missing a return type",a.pyQName)),"__init__"==x.name)u.push(W.mkText("constructor")),D(x,a.pyRetType,b.currClass.symInfo);else{if("__get__"==s||"__set__"==s){var l=null===(e=x.vars.value)||void 0===e?void 0:e.symbol;if("__set__"==s&&l){var f=ae(b.currClass.symInfo,"__get__");f&&f.pyAST&&"FunctionDef"==f.pyAST.kind&&R(x,l.pyRetType,f.pyRetType)}s=s.replace(/_/g,"")}o||(o="_"==s[0]?a.isProtected?"protected":"private":"public"),u.push(W.mkText(o+" "),Pe(s))}else Ze.U.assert(!o),"_"==x.name[0]||r||T||t?u.push(W.mkText("function "),Pe(s)):u.push(W.mkText("export function "),Pe(s));var c=x.returns?ye(x.returns):a.pyRetType;u.push(function(i,e){var t=i.args;t.kwonlyargs.length&&Z(i,9517,Ze.U.lf("keyword-only arguments not supported yet"));var n=t.args.slice();if(e?("self"!=n[0].arg&&Z(i,9518,Ze.U.lf("first argument of method has to be called 'self'")),n.shift()):n.some(function(e){return"self"==e.arg})&&Z(i,9519,Ze.U.lf("non-methods cannot have an argument called 'self'")),!i.symInfo.parameters){var a=t.defaults.length-n.length;i.symInfo.parameters=n.map(function(e){e.annotation||Z(i,9519,Ze.U.lf("Arg '{0}' missing annotation",e.arg));var n=ye(e.annotation),r="";return 0<=a&&(r=W.flattenNode([Qe(t.defaults[a])]).output,R(e,n,fe(t.defaults[a]))),a++,{name:e.arg,description:"",type:"",initializer:r,default:r,pyType:n}})}var r=i.symInfo.parameters.map(function(e){var n,r=null===(n=P(e.name,{isParam:!0}))||void 0===n?void 0:n.symbol;e.pyType||Z(i,9530,Ze.U.lf("parameter '{0}' missing pyType",e.name)),R(i,C(r),e.pyType);var t=[Pe(e.name),Se(e.pyType,!0)];return e.default&&t.push(W.mkText(" = "+e.default)),W.mkGroup(t)});return t.vararg&&r.push(W.mkText("TODO *"+t.vararg.arg)),t.kwarg&&r.push(W.mkText("TODO **"+t.kwarg.arg)),W.H.mkParenthesizedExpression(W.mkCommaSep(r))}(x,n),c&&I(c)!=S?Se(c):W.mkText("")),C(a);var p=x.body.map(je);if("__init__"==x.name){b.currClass||Z(x,9533,lf("__init__ method '{0}' is missing current class context",a.pyQName));for(var m=0,d=ie(b.currClass);m<d.length;m++){var y=d[m],v=y.pyAST;v&&v.value&&p.push(W.mkStmt(W.mkText("this."+Ue(y.pyName)+" = "),Qe(v.value)))}}var k=He(x);u.push(W.mkBlock(k.concat(p)));var g=W.mkGroup(u);return T?u[u.length-1].noFinalNewline=!0:g=W.mkStmt(g),g})}var Ee={FunctionDef:function(e){return Ne(e)},ClassDef:function(u){return e(u,function(){he(u);var e=te(8,u);Ze.U.assert(!b.currClass);var n=w();(b.currClass=u).isNamespace=u.decorator_list.some(function(e){return"Name"==e.kind&&"namespace"==e.id});var r,t,i=u.isNamespace?[W.mkText("namespace "),Pe(u.name)]:[me("keywords",u.keywords.map(de)),me("decorators",u.decorator_list.map(Qe)),W.mkText(n?"class ":"export class "),Pe(u.name)];if(!u.isNamespace&&0<u.bases.length)if("Enum"==Ae(u.bases[0]))u.isEnum=!0;else{i.push(W.mkText(" extends ")),i.push(W.mkCommaSep(u.bases.map(Qe)));var a=(r=u.bases[0],(t=le(we(r)))&&t.pyAST&&"ClassDef"==t.pyAST.kind?t.pyAST:null);a&&(u.baseClass=a,e.extendsTypes=[a.symInfo.pyQName])}var o=Te(u.body);i.push(o);var s=ie(u).filter(function(e){return 2==e.kind&&e.isInstance}).map(function(e){return e.pyName&&e.pyRetType||Z(u,9535,lf("field definition missing py name or ret type",e.qName)),e}).map(function(e){return W.mkStmt((n=e).pyName&&"_"==n.pyName[0]?n.isProtected?W.mkText("protected "):W.mkText("private "):W.mkText(""),Pe(e.pyName),Se(e.pyRetType));var n});return o.children=s.concat(o.children),W.mkStmt(W.mkGroup(i))})},Return:function(e){if(e.value){var n=b.currFun;return n&&(n.symInfo.pyRetType||Z(e,9536,lf("function '{0}' missing return type",n.symInfo.pyQName)),O(e.value,n.symInfo.pyRetType)),W.mkStmt(W.mkText("return "),Qe(e.value))}return W.mkStmt(W.mkText("return"))},AugAssign:function(e){var n=ke[e.op];return 3<n.length?W.mkStmt(W.mkInfix(Qe(e.target),"=",W.H.mkCall(n,[Qe(e.target),Qe(e.value)]))):W.mkStmt(Qe(e.target),W.mkText(" "+n+"= "),Qe(e.value))},Assign:function(e){return n(e)},AnnAssign:function(e){return n(e)},For:function(e){if(Ze.U.assert(0==e.orelse.length),e.target.forTargetEndPos=e.endPos,Ie(e.iter,"range")){var n=e.iter,r=Qe(e.target),t=Pe(we(e.target));O(e.target,f);var i=1==n.args.length?W.mkText("0"):Qe(n.args[0]),a=Qe(n.args[1==n.args.length?0:1]);return W.mkStmt(W.mkText("for ("),W.mkInfix(r,"=",i),W.mkText("; "),W.mkInfix(t,"<",a),W.mkText("; "),3<=n.args.length?W.mkInfix(t,"+=",Qe(n.args[2])):W.mkPostfix([t],"++"),W.mkText(")"),Te(e.body))}if(1<h){var o=fe(e.target);O(e.iter,fe(e.iter)==N?o:k(o))}return W.mkStmt(W.mkText("for ("),Qe(e.target),W.mkText(" of "),Qe(e.iter),W.mkText(")"),Te(e.body))},While:function(e){return Ze.U.assert(0==e.orelse.length),W.mkStmt(W.mkText("while ("),Qe(e.test),W.mkText(")"),Te(e.body))},If:function(e){var r=function(e){var n=[W.mkText("if ("),Qe(e.test),W.mkText(")"),Te(e.body)];return e.orelse.length&&(n[n.length-1].noFinalNewline=!0,1==e.orelse.length&&"If"==e.orelse[0].kind?(n.push(W.mkText(" else ")),Ze.U.pushRange(n,r(e.orelse[0]))):n.push(W.mkText(" else"),Te(e.orelse))),n};return W.mkStmt(W.mkGroup(r(e)))},With:function(e){var n,r,t,i;if(1==e.items.length&&(r=e.items[0].context_expr,t="pins.I2CDevice",(i=fe(r)).classType&&i.classType.pyQName==t||L(i)==t)){var a=e.items[0],o=[],s=Qe(a.context_expr);if(a.optional_vars){var u=Ae(a.optional_vars);if(u){var l=null===(n=P(u,{isLocal:!0}))||void 0===n?void 0:n.symbol;u=Ue(u),o.push(W.mkStmt(W.mkText("const "+u+" = "),s)),l.pyRetType||Z(e,9537,lf("function '{0}' missing return type",l.pyQName)),O(a.context_expr,l.pyRetType),s=W.mkText(u)}}return o.push(W.mkStmt(W.mkInfix(s,".",W.mkText("begin()")))),Ze.U.pushRange(o,e.body.map(je)),o.push(W.mkStmt(W.mkInfix(s,".",W.mkText("end()")))),W.mkGroup(o)}var f=[],c=e.items.map(function(e,n){var r="with"+n;if(e.optional_vars){var t=we(e.optional_vars);P(t,{isLocal:!0}),r=Ue(t)}return f.push(W.mkStmt(W.mkText(r+".end()"))),W.mkStmt(W.mkText("const "+r+" = "),W.mkInfix(Qe(e.context_expr),".",W.mkText("begin()")))});return Ze.U.pushRange(c,e.body.map(je)),Ze.U.pushRange(c,f),W.mkBlock(c)},Raise:function(e){var n=e.exc||e.cause;if(!n)return W.mkStmt(W.mkText("throw"));var r=void 0;if(n&&"Call"==n.kind){var t=n;1==t.args.length&&(r=Qe(t.args[0]))}return r||(r=W.mkGroup([W.mkText("`"),Qe(n),W.mkText("`")])),W.mkStmt(W.H.mkCall("control.fail",[r]))},Assert:function(e){return e.msg||Z(e,9537,lf("assert missing message")),W.mkStmt(W.H.mkCall("control.assert",[e.test,e.msg].filter(function(e){return!!e}).map(Qe)))},Import:function(e){for(var n=0,r=e.names;n<r.length;n++){var t=r[n];t.asname&&P(t.asname,{expandsTo:t.name}),i=e,a=t.name,void 0,U(a)||Z(i,9503,Ze.U.lf("No module named '{0}'",a))}var i,a;return W.mkText("")},ImportFrom:function(e){for(var n=[],r=0,t=e.names;r<t.length;r++){var i=t[r];if("*"==i.name)e.module||Z(e,9538,lf("import missing module name")),P(e.module,{isImportStar:!0});else{var a=e.module+"."+i.name,o=U(a),s=i.asname||i.name;ce(o)?(P(s,{isImport:o,expandsTo:a}),n.push(W.mkStmt(W.mkText("import "+Ue(s)+" = "+a)))):P(s,{expandsTo:a})}}return W.mkGroup(n)},ExprStmt:function(e){return"Str"==e.value.kind?((n=e.value.s).trim().split(/\n/).length<=1?n=n.trim():n+="\n",W.mkStmt(W.mkText("/** "+n+" */"))):W.mkStmt(Qe(e.value));var n},Pass:function(e){return W.mkStmt(W.mkText(""))},Break:function(e){return W.mkStmt(W.mkText("break"))},Continue:function(e){return W.mkStmt(W.mkText("continue"))},Delete:function(e){return Z(e,9550,Ze.U.lf("delete statements are unsupported")),v(e)},Try:function(e){for(var n=[W.mkText("try"),Te(e.body.concat(e.orelse))],r=0,t=e.handlers;r<t.length;r++){var i=t[r];n.push(W.mkText("catch ("),i.name?Pe(i.name):W.mkText("_")),i.type&&n.push(W.mkText("/* instanceof "),Qe(i.type),W.mkText(" */")),n.push(W.mkText(")"),Te(i.body))}return e.finalbody.length&&n.push(W.mkText("finally"),Te(e.finalbody)),W.mkStmt(W.mkGroup(n))},AsyncFunctionDef:function(e){return Z(e,9551,Ze.U.lf("async function definitions are unsupported")),v(e)},AsyncFor:function(e){return Z(e,9552,Ze.U.lf("async for statements are unsupported")),v(e)},AsyncWith:function(e){return Z(e,9553,Ze.U.lf("async with statements are unsupported")),v(e)},Global:function(e){for(var n=x(),r=(A(),0),t=e.names;r<t.length;r++){var i=t[r];Ze.U.lookup(n.vars,i)||Z(e,9521,Ze.U.lf("No binding found for global variable")),P(i,{},q.VarModifier.Global).firstRefPos<e.startPos&&Z(e,9522,Ze.U.lf("Variable referenced before global declaration"))}return W.mkStmt(W.mkText(""))},Nonlocal:function(e){for(var n=x(),r=A(),t=0,i=e.names;t<i.length;t++){var a=i[t],o=We(a,r);o&&o!==n&&o.vars[a].modifier!==q.VarModifier.Global||Z(e,9523,Ze.U.lf("No binding found for nonlocal variable")),P(a,{},q.VarModifier.NonLocal).firstRefPos<e.startPos&&Z(e,9524,Ze.U.lf("Variable referenced before nonlocal declaration"))}return W.mkStmt(W.mkText(""))}};function n(e){var n,r,t,i;if("Assign"===e.kind){if(1!=e.targets.length)return Z(e,9553,Ze.U.lf("multi-target assignment statements are unsupported")),v(e);i=e.targets[0],t=e.value,r=null}else{if("AnnAssign"!==e.kind)return e;i=e.target,t=e.value||null,r=e.annotation}var a="",o=!!t&&Ie(t,"const"),s=Ae(i)||"";if(w()||b.currClass||b.currFun||"_"==s[0]||(a="export "),s&&b.currClass&&!b.currFun){o=!(!t||!b.currClass.isNamespace);var u=ae(b.currClass.symInfo,s);if(u||Z(e,9544,lf("cannot get class field")),0==h)return W.mkText("/* skip for now */");u.pyRetType||Z(e,9539,lf("function '{0}' missing return type",u.pyQName)),O(i,u.pyRetType),u.isInstance=!1,a=b.currClass.isNamespace?"export "+(o?"const":"let")+" ":"static "}if(!t)return Z(e,9555,Ze.U.lf("unable to determine value of assignment")),v(e);if(O(i,fe(t)),o)return P(we(i),{}),/^static /.test(a)||/const/.test(a)||(a+="const "),W.mkStmt(W.mkText(a),W.mkInfix(Qe(i),"=",Qe(t)));if(!a&&"Tuple"==i.kind){var l=i,f=[W.mkText("let "),W.mkText("[")];if(l.elts.filter(function(e){return"Name"!==e.kind}).length)return Z(e,9556,Ze.U.lf("non-trivial tuple assignment unsupported")),v(e);var c=l.elts.map(function(e){return e}).map(function(e){Oe(e,"identifierCompletion"),fe(e);qe(e);return Ce(e,!0)});return f.push(W.mkCommaSep(c)),f.push(W.mkText("]")),W.mkStmt(W.mkInfix(W.mkGroup(f),"=",Qe(t)))}if("Name"===i.kind){var p=A().vars[s],m=null===(n=p)||void 0===n?void 0:n.symbol;m&&4===m.kind&&void 0===p.modifier&&(void 0===p.firstAssignPos||p.firstAssignPos>i.startPos)&&(p.firstAssignPos=i.startPos,p.firstAssignDepth=b.blockDepth)}var d=void 0;if(r&&("NameConstant"===t.kind&&null===t.value||"List"===t.kind&&0===t.elts.length)){var y=L(ye(r));d=W.mkInfix(Qe(i),":",W.mkText(y))}return d||(d=Qe(i)),W.mkStmt(W.mkText(a),W.mkInfix(d,"=",Qe(t)))}function Ce(e,n){var r,t;void 0===n&&(n=!1);var i=e.id,a=ue(i),o=null===(r=a)||void 0===r?void 0:r.symbol,s=null===(t=A().vars[i])||void 0===t?void 0:t.symbol;return void 0===e.isdef&&(!o||4===o.kind&&o!==s?(b.currClass&&!b.currFun?(e.isdef=!1,a=P(i,{})):a=P(i,{isLocal:e.isdef=!0}),o=a.symbol):e.isdef=!1,e.symbolInfo=o,e.tsType||Z(e,9540,lf("definition missing ts type")),o.pyRetType||Z(e,9568,lf("missing py return type")),R(e,e.tsType,o.pyRetType)),e.isdef&&$e(a,A())&&(e.isdef=!1),Be(a,e),e.isdef&&!n?W.mkGroup([W.mkText("let "),Pe(i)]):Pe(i)}function Ue(e){return W.isReservedWord(e)?e+"_":e||e}function Ae(e){var n;if("Name"==e.kind){var r=e.id,t=null===(n=a(r))||void 0===n?void 0:n.symbol;return t&&t.expandsTo?t.expandsTo:r}if("Attribute"==e.kind){var i=Ae(e.value);if(i)return i+"."+e.attr}}function we(e){var n=Ae(e);return n||Z(null,9542,lf("Cannot get name of unknown expression kind '{0}'",e.kind)),n}function Pe(e){return"self"==e?W.mkText("this"):W.mkText(Ue(e))}function Ie(e,n){return"Call"==e.kind&&Ae(e.func)===n}function _e(e,n,r){var t=ke[n];return Ze.U.assert(!!t),3<t.length?W.H.mkCall(t,[e,r]):W.mkInfix(e,t,r)}var Ke={memoryview:{n:"",t:J},const:{n:"",t:f},"micropython.const":{n:"",t:f}};var Le,Fe=(Le={},Object.keys(pxtc.ts2PyFunNameMap).forEach(function(e){var n=pxtc.ts2PyFunNameMap[e];if(n&&n.n){var r={n:e,t:function(e){switch(e){case ts.SyntaxKind.StringKeyword:return N;case ts.SyntaxKind.NumberKeyword:return f;case ts.SyntaxKind.BooleanKeyword:return i;case ts.SyntaxKind.VoidKeyword:return S;case ts.SyntaxKind.AnyKeyword:return p;default:return J}}(n.t),scale:n.scale};Le[n.n]=r}}),Object.keys(Ke).forEach(function(e){Le[e]=Ke[e]}),Le);function De(e){return j&&e.startPos<=j.position&&j.position<=e.endPos}function Oe(e,n){100<h&&j&&null==$&&(j.type==n||"symbol"==j.type)&&De(e)&&($=e,V=A())}function Re(e,n){if(n&&n.pyAST&&"FunctionDef"==n.pyAST.kind){var r=n.pyAST;r.callers||(r.callers=[]),r.callers.indexOf(e)<0&&r.callers.push(e)}}var Me={BoolOp:function(e){for(var n=Qe(e.values[0]),r=1;r<e.values.length;++r)n=_e(n,e.op,Qe(e.values[r]));return n},BinOp:function(e){var n=function(e){if("Mod"==e.op&&"Str"==e.left.kind&&("Tuple"==e.right.kind||"List"==e.right.kind)){var n=e.left.s,o=e.right.elts;o=o.slice();var s=[W.mkText("`")];return n.replace(/([^%]+)|(%[\d\.]*([a-zA-Z%]))/g,function(e,n,r,t){if(n)s.push(W.mkText(n.replace(/[`\\$]/g,function(e){return"\\"+e})));else{var i=o.shift(),a=i?Qe(i):W.mkText("???");s.push(W.mkText("${"),a,W.mkText("}"))}return""}),s.push(W.mkText("`")),W.mkGroup(s)}return null}(e);if(n)return n;var r=Qe(e.left),t=Qe(e.right);return Ye(e.left)&&Ye(e.right)&&"Add"===e.op?W.H.extensionCall("concat",[r,t],!1):(n=_e(r,e.op,t),ve[e.op]&&(O(e.left,f),O(e.right,f),e.tsType||Z(e,9570,lf("binary op missing ts type")),R(e,e.tsType,f)),n)},UnaryOp:function(e){var n=ge[e.op];return Ze.U.assert(!!n),W.mkInfix(null,n,Qe(e.operand))},Lambda:function(e){return l(e)},IfExp:function(e){return W.mkInfix(W.mkInfix(Qe(e.test),"?",Qe(e.body)),":",Qe(e.orelse))},Dict:function(t){b.blockDepth++;var e=t.keys.map(function(e,n){var r=t.values[n];return void 0===e?l(t):W.mkStmt(W.mkInfix(Qe(e),":",Qe(r)),W.mkText(","))}),n=W.mkBlock(e);return b.blockDepth--,n},Set:function(e){return l(e)},ListComp:function(e){return l(e)},SetComp:function(e){return l(e)},DictComp:function(e){return l(e)},GeneratorExp:function(n){if(1==n.generators.length&&"Comprehension"==n.generators[0].kind){var r=n.generators[0];if(0==r.ifs.length)return pe(function(){var e=we(r.target);return P(e,{isParam:!0}),W.mkInfix(Qe(r.iter),".",W.H.mkCall("map",[W.mkGroup([Pe(e),W.mkText(" => "),Qe(n.elt)])]))})}return l(n)},Await:function(e){return l(e)},Yield:function(e){return l(e)},YieldFrom:function(e){return l(e)},Compare:function(e){if(1==e.ops.length&&("In"==e.ops[0]||"NotIn"==e.ops[0])){I(fe(e.comparators[0]))==N&&O(e.left,N);var n=W.mkInfix(Qe(e.comparators[0]),".",W.H.mkCall("indexOf",[Qe(e.left)]));return W.mkInfix(n,"In"==e.ops[0]?">=":"<",W.mkText("0"))}for(var r=_e(Qe(e.left),e.ops[0],Qe(e.comparators[0])),t=1;t<e.ops.length;++t)r=_e(r,"And",_e(Qe(e.comparators[t-1]),e.ops[t],Qe(e.comparators[t])));return r},Call:function(e){e.func.inCalledPosition=!0;var n,r=Ae(e.func),t=le(r),i=t&&8==t.kind,a=t,o=void 0,s="";if(i)a=le(t.pyQName+".__constructor");else if("Attribute"==e.func.kind){var u=e.func;((n=fe(o=u.value)).classType||n.primType)&&(s=u.attr,(a=oe(o,s,!0))&&(s=a.name))}var l=e.args.slice();if("super"==r&&0==l.length)return b.currClass&&b.currClass.baseClass&&(e.tsType||Z(e,9543,lf("call expr missing ts type")),D(e,e.tsType,b.currClass.baseClass.symInfo)),W.mkText("super");if(!a){var f=Ze.U.lookup(Fe,r);if(f&&(s=""),s&&(r=L(n)+"."+s,(f=Ze.U.lookup(Fe,r))||"@array"!=F(I(n))||(r="Array."+s,f=Ze.U.lookup(Fe,r))),s="",f)if("."==f.n[0]&&l.length){if(n=fe(o=l.shift()),s=f.n.slice(1),(a=oe(o,s))&&2==a.kind)return W.mkInfix(Qe(o),".",W.mkText(s))}else a=U(f.n)}if(Ie(e,"str"))return R(e,e.tsType,N),W.mkInfix(W.mkText('""'),"+",Qe(e.args[0]));a||Z(e,9508,Ze.U.lf("can't find called function \""+r+'"'));var c=a?a.parameters:null,p=[];if(c){for(l.length>c.length&&Z(e,9510,Ze.U.lf("too many arguments in call to '{0}'",a.pyQName));l.length<c.length;)l.push(null);l=l.slice(0,c.length);for(var m=function(n){var e=c.findIndex(function(e){return e.name==n.arg});e<0?Z(n,9511,Ze.U.lf("'{0}' doesn't have argument named '{1}'",a.pyQName,n.arg)):null!=l[e]?Z(n,9512,Ze.U.lf("argument '{0} already specified in call to '{1}'",n.arg,a.pyQName)):l[e]=n.value},d=0,y=e.keywords;d<y.length;d++){m(y[d])}for(var v=l.length-1;0<=v&&(c[v].initializer&&null==l[v]);v--)l.pop();for(v=0;v<l.length;++v){null!=(k=l[v])||c[v].initializer?k?(c[v].pyType||Z(e,9545,lf("formal arg missing py type")),"any"!==c[v].pyType.primType&&O(k,c[v].pyType),"Name"==k.kind&&be(k.symbolInfo)?p.push(Ne(k.symbolInfo.pyAST,!0)):p.push(Qe(k))):(c[v].initializer||Z(e,9547,lf("formal arg missing initializer")),p.push(W.mkText(c[v].initializer))):(Z(e,9513,Ze.U.lf("missing argument '{0}' in call to '{1}'",c[v].name,a.pyQName)),p.push(W.mkText("null")))}}else a&&Z(e,9509,Ze.U.lf("calling non-function")),p=l.map(Qe);if(!$&&j&&"signature"==j.type&&De(e)){$=e,V=A();for(v=j.auxResult=0;v<l.length;++v){var k;if(j.auxResult=v,!(k=l[v]))break;if(k.startPos<=j.position&&j.position<=k.endPos)break}}if(a)if(a.pyRetType||Z(e,9549,lf("function missing pyRetType")),O(e,a.pyRetType),(e.symbolInfo=a).attributes.py2tsOverride){var g=function(e){var n,r=new RegExp(/([^\$]*\()?([^\$\(]*)\$(\d)(?:(?:(?:=(\d+|'[a-zA-Z0-9_]*'|false|true|null|undefined))|(\?)|))/,"y"),t=[],i=0;for(;i=r.lastIndex,(n=r.exec(e))&&(n[1]&&t.push({kind:"text",text:n[1]}),t.push({kind:"arg",prefix:n[2],index:parseInt(n[3]),default:n[4],isOptional:!!n[5]})),n;);null!=i?t.push({kind:"text",text:e.substr(i)}):t.push({kind:"text",text:e});return{parts:t}}(a.attributes.py2tsOverride);if(g){s&&!o&&Z(e,9550,lf("missing recv"));var x=function(e,n,r){for(var t=[],i=0,a=e.parts;i<a.length;i++){var o=a[i];if("text"===o.kind)t.push(W.mkText(o.text));else if(n[o.index]||o.default)o.prefix&&t.push(W.mkText(o.prefix)),n[o.index]?t.push(n[o.index]):t.push(W.mkText(o.default));else if(!o.isOptional)return}if(r)return W.mkInfix(r,".",W.mkGroup(t));return W.mkGroup(t)}(g,p,s?Qe(o):void 0);return x||Z(e,9555,lf("buildOverride failed unexpectedly")),x}}else if(a.attributes.pyHelper)return W.mkGroup([W.mkInfix(W.mkText("_py"),".",W.mkText(a.attributes.pyHelper)),W.mkText("("),W.mkCommaSep(o?[Qe(o)].concat(p):p),W.mkText(")")]);var T,h=s?W.mkInfix(Qe(o),".",W.mkText(s)):Qe(e.func),S=[h,W.mkText("("),W.mkCommaSep(p),W.mkText(")")];return a&&1==p.length&&E(a)&&(S=[h,(T=p[0],T.type==W.NT.Prefix&&'"'==T.op[0]?W.mkText(W.backtickLit(JSON.parse(T.op))):T)]),i&&(t&&t.pyQName||Z(e,9551,lf("missing namedSymbol or pyQName")),S[0]=W.mkText(K(t.pyQName)),S.unshift(W.mkText("new "))),W.mkGroup(S)},Num:function(e){return e.tsType||Z(e,9556,lf("tsType missing")),R(e,e.tsType,f),W.mkText(e.ns)},Str:function(e){return e.tsType||Z(e,9557,lf("tsType missing")),R(e,e.tsType,N),W.mkText(W.stringLit(e.s))},FormattedValue:function(e){return l(e)},JoinedStr:function(e){return l(e)},Bytes:function(e){return W.mkText("hex`"+Ze.U.toHex(new Uint8Array(e.s))+"`")},NameConstant:function(e){return null!==e.value&&(e.tsType||Z(e,9558,lf("tsType missing")),R(e,e.tsType,i)),W.mkText(JSON.stringify(e.value))},Ellipsis:function(e){return l(e)},Constant:function(e){return l(e)},Attribute:function(e){var n=Qe(e.value),r=fe(e.value),t=oe(e.value,e.attr),i=e.attr;if(Oe(e,"memberCompletion"),t)e.symbolInfo=t,Re(e,t),e.tsType&&t.pyRetType||Z(e,9559,lf("tsType or pyRetType missing")),R(e,e.tsType,t.pyRetType),i=t.name;else if(r.moduleType){var a=U(r.moduleType.pyQName+"."+e.attr);a?(e.symbolInfo=a,Re(e,a),O(e,C(a)),i=a.name):Z(e,9514,Ze.U.lf("module '{0}' has no attribute '{1}'",r.moduleType.pyQName,e.attr))}else 2<h&&Z(e,9515,Ze.U.lf("unknown object type; cannot lookup attribute '{0}'",e.attr));return W.mkInfix(n,".",W.mkText(Ue(i)))},Subscript:function(e){var n;if("Index"==e.slice.kind){var r=I(fe(e.value));if(Ye(e.value))O(e,r.typeArgs[0]);else"string"===r.primType?O(e,r):2<h&&T(fe(e))&&O(e,p);var t=e.slice.value;return 2<h&&T(fe(t))&&O(t,f),W.mkGroup([Qe(e.value),W.mkText("["),Qe(t),W.mkText("]")])}if("Slice"==e.slice.kind){var i=fe(e.value);O(e,i);var a=e.slice;if(a.step){var o="string"===(null===(n=i)||void 0===n?void 0:n.primType);return W.H.mkCall(o?"_py.stringSlice":"_py.slice",[Qe(e.value),a.lower?Qe(a.lower):W.mkText("null"),a.upper?Qe(a.upper):W.mkText("null"),Qe(a.step)])}return W.mkInfix(Qe(e.value),".",W.H.mkCall("slice",[a.lower?Qe(a.lower):W.mkText("0"),a.upper?Qe(a.upper):null].filter(c)))}return l(e)},Starred:function(e){return W.mkGroup([W.mkText("... "),Qe(e.value)])},Name:function(e){var n;if(Oe(e,"identifierCompletion"),"self"==e.id&&b.currClass)return e.tsType||Z(e,9560,lf("missing tsType")),D(e,e.tsType,b.currClass.symInfo),W.mkText("this");var r=qe(e),t=null===(n=r)||void 0===n?void 0:n.symbol;return t&&t.isImport?Pe(t.name):(Be(r,e),0<=e.ctx.indexOf("Load")?(t&&!t.qName&&Z(e,9561,lf("missing qName")),Pe(t?t.qName:we(e))):Ce(e))},List:Ge,Tuple:Ge};function qe(e){var n,r=ue(e.id),t=null===(n=r)||void 0===n?void 0:n.symbol;if(!r){var i=Ze.U.lookup(Fe,e.id);i&&(r=ue(i.n))}if(r&&t){if(e.symbolInfo=t,e.tsType||Z(e,9562,lf("missing tsType")),R(e,e.tsType,C(t)),t.isImport)return r;Re(e,t),e.forTargetEndPos&&r.forVariableEndPos!==e.forTargetEndPos&&(r.forVariableEndPos?r.lastRefPos=r.forVariableEndPos+1:r.forVariableEndPos=e.forTargetEndPos)}else 0<h&&Z(e,9516,Ze.U.lf("name '{0}' is not defined",e.id));return r}function Be(e,n){if(e){if(e.modifier===q.VarModifier.Global)(r=x())&&r.vars[e.symbol.name]&&(e=r.vars[e.symbol.name]);else if(e.modifier===q.VarModifier.NonLocal){var r;(r=We(e.symbol.name,A()))&&(e=r.vars[e.symbol.name])}(void 0===e.firstRefPos||e.firstRefPos>n.startPos)&&(e.firstRefPos=n.startPos),(void 0===e.lastRefPos||e.lastRefPos<n.startPos)&&(e.lastRefPos=n.startPos)}}function Ge(e){return e.tsType||Z(e,9563,lf("missing tsType")),R(e,e.tsType,k(e.elts[0]?fe(e.elts[0]):y())),W.mkGroup([W.mkText("["),W.mkCommaSep(e.elts.map(Qe)),W.mkText("]")])}function ze(e){return e.startPos+":"+e.endPos}function Qe(e){var n=Me[(u=e).kind];n||Ze.U.oops(e.kind+" - unknown expr"),fe(e);var r=n(e);return r.id=ze(e),r}function je(e){var n=Ee[(u=e).kind];n||Ze.U.oops(e.kind+" - unknown stmt");var r=(e._comments||[]).map(function(e){return e.value}),t=n(e);return r.length&&(t=W.mkGroup(r.map(function(e){return W.mkStmt(W.H.mkComment(e))}).concat(t))),t.id=ze(e),t}function Ve(e){return!e||(e.type==W.NT.Prefix&&""==e.op?e.children.every(Ve):e.type==W.NT.NewLine)}function We(e,n){if(n){var r=n.vars&&n.vars[e];return r&&r.modifier!=q.VarModifier.NonLocal?n:We(e,n.parent)}}function He(e){for(var n,r,t,i,a,o=[],s=0,u=Object.keys(e.vars);s<u.length;s++){var l=u[s];$e(r=e.vars[l],e)&&o.push((t=null===(n=r)||void 0===n?void 0:n.symbol,void 0,i=Pe(t.name),a=L(C(t)),W.mkStmt(W.mkGroup([W.mkText("let "),i,W.mkText(": "+a+";")]))))}return o}function $e(e,n){var r;return!!(4===e.symbol.kind&&!e.symbol.isParam&&void 0===e.modifier&&(e.lastRefPos>e.forVariableEndPos||e.firstRefPos<e.firstAssignPos||e.firstAssignDepth>n.blockDepth)&&!("Module"===(r=n).kind&&"main"===r.name&&0===e.firstAssignDepth))}function Je(e){if(Ze.U.assert("Module"==e.kind),!e.tsBody){var n;b={currClass:void 0,currFun:void 0,currModule:n=e,blockDepth:0},z=n.tsFilename.replace(/\.ts$/,".py"),e.vars||(e.vars={});var r=He(e).concat(e.body.map(je));if(!r.every(Ve))return"main"==e.name?r:[W.mkText("namespace "+e.name+" "),W.mkBlock(r)]}}function Xe(e){h=e,Q=[],u=void(H=0)}function Ye(e){var n=I(fe(e));return n&&"@array"===n.primType}q.py2ts=function(t){var e=[],n={};Q=[],Ze.U.assert(!!t.sourceFiles,"missing sourceFiles! Cannot convert py to ts");var r=t.sourceFiles.filter(function(e){return Ze.U.endsWith(e,".py")});if(0==r.length)return{outfiles:n,diagnostics:Q,success:0===Q.length,sourceMap:[]};var i=function(e,n){return e.substr(0,e.length-n.length)},a=Ze.U.toDictionary(r,function(e){return i(e,".py")}),o=t.sourceFiles.filter(function(e){return Ze.U.endsWith(e,".ts")}).filter(function(e){return i(e,".ts")in a});Ze.U.assert(!!t.apisInfo,"missing apisInfo! Cannot convert py to ts"),z=r[0],function(e,n){G={},B={};for(var r=Ze.U.toDictionary(n,function(e){return e}),t=function(e){if(r.hasOwnProperty(e.fileName))return"continue";var n=e;n.extendsTypes&&(n.extendsTypes=n.extendsTypes.filter(function(e){return e!=n.qName})),n.pyQName&&n.qName||Z(null,9526,Ze.U.lf("Symbol '{0}' is missing qName for '{1}'",n.name,n.pyQName?"ts":"py")),B[n.pyQName]=n,B[n.qName]=n},i=0,a=Ze.U.values(e.byQName);i<a.length;i++)t(a[i]);J=Y("Buffer")}(t.apisInfo,o),j=void 0,t.generatedFiles||(t.generatedFiles=[]);for(var s=0,u=r;s<u.length;s++){var l=u[s],f=l,c=l.replace(/\.py$/,"").replace(/.*\//,""),p=t.fileSystem[l];try{z=l;var m=Ze.py.lex(p),d=Ze.py.parse(p,f,m);Ze.U.pushRange(Q,d.diagnostics),e.push({kind:"Module",body:d.stmts,blockDepth:0,name:c,source:p,tsFilename:f.replace(/\.py$/,".ts")})}catch(e){console.log("Parse error",e)}}for(var y=Q,v=0;v<5;++v){Xe(v);for(var k=0,g=e;k<g.length;k++){var x=g[k];try{Je(x)}catch(e){console.log("Conv pass error",e)}}if(0==H)break}Xe(1e3),$=void 0,j=t.syntaxInfo||{position:0,type:"symbol"};for(var T=[],h=0,S=e;h<S.length;h++){x=S[h];try{var b=Je(x);if(!b)continue;function N(e){var n=e.id.split(":");if(2==n.length){var r=n.map(function(e){return parseInt(e)});return{py:{startPos:r[0],endPos:r[1]},ts:{startPos:e.startPos,endPos:e.endPos}}}}d=W.flattenNode(b),t.sourceFiles.push(x.tsFilename),t.generatedFiles.push(x.tsFilename),t.fileSystem[x.tsFilename]=d.output,n[x.tsFilename]=d.output,T=d.sourceMap.map(N).filter(function(e){return!!e})}catch(e){console.log("Conv error",e)}}Q=y.concat(Q);for(var E={},C=Ze.U.values(B).concat(Ze.U.values(G)),U=[],A=function(e){if(function(e){switch(e.kind){case 6:case 7:case 4:case 3:case 5:return!0;case 2:case 1:return!e.isInstance;default:return!1}}(e)&&U.indexOf(e)<0){var n=X(e);E[n.qName||n.name]=n}},w=V;w;w=w.parent)w&&w.vars&&Ze.U.values(w.vars).map(function(e){return e.symbol}).forEach(A);if(C.forEach(A),j&&$){if($=$,j.beginPos=$.startPos,j.endPos=$.endPos,j.symbols||(j.symbols=[]),U=j.symbols.slice(),"memberCompletion"==j.type&&"Attribute"==$.kind){var P=fe($.value);if(P.moduleType)for(var I=0,_=C;I<_.length;I++)(O=_[I]).isInstance||O.namespace!=P.moduleType.qName||j.symbols.push(O);else if(P.classType||P.primType){var K=P.classType||se(P.primType).reduce(function(e,n){return e||n},null);if(K){K.extendsTypes&&K.qName||Z(null,9567,lf("missing extendsTypes or qName"));for(var L=K.extendsTypes.concat(K.qName),F=0,D=C;F<D.length;F++){var O;(O=D[F]).isInstance&&0<=L.indexOf(O.namespace)&&j.symbols.push(O)}}}}else if("identifierCompletion"==j.type)j.symbols=Ze.U.values(E);else{var R=$.symbolInfo;R&&j.symbols.push(R)}j.symbols=j.symbols.map(X)}var M=function(){for(var e=0,n=Q;e<n.length;e++){var r=n[e];q.patchPosition(r,t.fileSystem[r.fileName])}return Q}();return{outfiles:n,success:0===M.length,diagnostics:M,syntaxInfo:j,globalNames:E,sourceMap:T}}}(Ze.py||(Ze.py={}))}(pxt||(pxt={})),function(K){!function(h){var S,e;(e=S=h.TokenType||(h.TokenType={}))[e.Id=0]="Id",e[e.Op=1]="Op",e[e.Keyword=2]="Keyword",e[e.Number=3]="Number",e[e.String=4]="String",e[e.NewLine=5]="NewLine",e[e.Comment=6]="Comment",e[e.Indent=7]="Indent",e[e.Dedent=8]="Dedent",e[e.EOF=9]="EOF",e[e.Error=10]="Error",h.keywords={False:!0,None:!0,True:!0,and:!0,as:!0,assert:!0,async:!0,await:!0,break:!0,class:!0,continue:!0,def:!0,del:!0,elif:!0,else:!0,except:!0,finally:!0,for:!0,from:!0,global:!0,if:!0,import:!0,in:!0,is:!0,lambda:!0,nonlocal:!0,not:!0,or:!0,pass:!0,raise:!0,return:!0,try:!0,while:!0,with:!0,yield:!0};var b,N,i,E,C=[],U={"%":"Mod","&":"BitAnd","*":"Mult","**":"Pow","+":"Add","-":"Sub","/":"Div","//":"FloorDiv","<<":"LShift",">>":"RShift","@":"MatMult","^":"BitXor","|":"BitOr"},A={"!":"Bang","!=":"NotEq","(":"LParen",")":"RParen",",":"Comma","->":"Arrow",".":"Dot",":":"Colon",";":"Semicolon","<":"Lt","<=":"LtE","=":"Assign","==":"Eq",">":"Gt",">=":"GtE","[":"LSquare","]":"RSquare","{":"LBracket","}":"RBracket","~":"Invert"},w={b:/^[_0-1]$/,B:/^[_0-1]$/,o:/^[_0-7]$/,O:/^[_0-7]$/,x:/^[_0-9a-fA-F]$/,X:/^[_0-9a-fA-F]$/},P={b:2,B:2,o:8,O:8,x:16,X:16},I=0,_=0;function t(e,n){for(var r=0,t=0,i=0;i<e;++i)10==n.charCodeAt(i)&&(r++,t=i);return{line:r,column:e-t-1}}function s(e){switch(e.type){case S.Id:return"id("+e.value+")";case S.Op:return"'"+N[e.value]+"'";case S.Keyword:return e.value;case S.Number:return"num("+e.value+")";case S.String:return e.stringPrefix+JSON.stringify(e.value);case S.NewLine:return"<nl>";case S.Comment:return"/* "+e.value+" */";case S.Indent:return"indent"+e.value;case S.Dedent:return"dedent";case S.Error:return"[ERR: "+e.value+"]";case S.EOF:return"End of file";default:return"???"}}h.position=t,h.patchPosition=function(e,n){if(!e.start&&!e.length)return e.start=0,e.length=0,e.line=0,void(e.column=0);var r=t(e.start,n);e.line=r.line,e.column=r.column,0<e.length&&(r=t(e.start+e.length-1,n),e.endLine=r.line,e.endColumn=r.column+2)},h.tokenToString=s,h.friendlyTokenToString=function(e,n){var r=e.endPos-e.startPos;return(0==r?s(e):20<r?"`"+n.slice(e.startPos,e.startPos+20)+"`...":"`"+n.slice(e.startPos,e.endPos)+"`").replace(/\r/g,"").replace(/\n/g,"\\n").replace(/\t/g,"\\t")},h.tokensToString=function(e){for(var n="",r=0,t=0,i=e;t<i.length;t++){var a=i[t],o=s(a);70<r+o.length&&(r=0,n+="\n"),0!=r&&(n+=" "),n+=o,r+=o.length,a.type!=S.NewLine&&a.type!=S.Comment||(r=0,n+="\n")}return n},h.lex=function(e){for(0==C.length&&function(){var s={'"':f,"'":f,"#":v,"\\":y,".":g};b=K.U.clone(A);for(var e=0,n=Object.keys(U);e<n.length;e++){var r=n[e];b[r]=U[r],b[r+"="]=U[r]+"Assign"}N={};for(var t=0,i=Object.keys(b);t<i.length;t++){var r=i[t];N[b[r]]=r}for(var a=function(e){if(h.rx.isIdentifierStart(e))C[e]=u;else{var n=String.fromCharCode(e);if(s.hasOwnProperty(n))C[e]=s[n];else if(b.hasOwnProperty(n)){for(var r=!1,t=b[n],i=0,a=Object.keys(b);i<a.length;i++){var o=a[i];o!=n&&o.startsWith(n)&&(r=!0)}C[e]=r?function(){return function(e){var n=E.slice(_,I+1);if(2==n.length&&b.hasOwnProperty(n)){var r=E.slice(_,I+2);3==r.length&&b.hasOwnProperty(r)?(I+=2,e=b[r]):(I++,e=b[n])}l(e)}(t)}:function(){return l(t)}}else h.rx.isSpace(e)?C[e]=function(){}:13==e?C[e]=function(){10==E.charCodeAt(I)&&I++,c()}:h.rx.isNewline(e)?C[e]=c:x(e)?C[e]=k:C[e]=T}},o=0;o<128;++o)a(o)}(),E=e,i=[],_=I=0,t();I<E.length;){_=I;var n=E.charCodeAt(I++);n<128?C[n]():h.rx.isIdentifierStart(n)?u():h.rx.isSpace(n)||(h.rx.isNewline(n)?c():T())}return _=I,c(),p(S.EOF,""),i;function p(e,n,r){var t={type:e,value:n,startPos:_,endPos:I,auxValue:r};return i.push(t),t}function m(e){p(S.Error,e)}function u(){for(;h.rx.isIdentifierChar(E.charCodeAt(I));)I++;var e=E.slice(_,I),n=E.charCodeAt(I);h.keywords.hasOwnProperty(e)?p(S.Keyword,e):34==n||39==n?r(e):p(S.Id,e)}function l(e){p(S.Op,e)}function d(e){switch(e){case 97:return 7;case 98:return 8;case 102:return 12;case 110:return 10;case 114:return 13;case 116:return 9;case 118:return 11;default:return 0}}function r(e){var n=E.charCodeAt(I++),r=!1;E.charCodeAt(I)==n&&E.charCodeAt(I+1)==n&&(I+=2,r=!0);for(var t=0<=(e=e.toLowerCase()).indexOf("r"),i="",a="";;){var o=E.charCodeAt(I++);if(o==n){if(!r)break;if(E.charCodeAt(I)==n&&E.charCodeAt(I+1)==n){I+=2;break}a+="\\"+String.fromCharCode(n),i+=String.fromCharCode(n)}else if(92==o){var s=E.charCodeAt(I++);if(13==s&&10==E.charCodeAt(I)&&(s=10,I++),34==s||39==s||92==s)t&&(a+="\\",i+="\\"),a+="\\"+String.fromCharCode(s),i+=String.fromCharCode(s);else if(!t&&d(s))a+="\\"+String.fromCharCode(s),i+=String.fromCharCode(d(s));else if(h.rx.isNewline(s))t&&(i+="\\"+String.fromCharCode(s),a+="\\\\",a+=10==s?"\\n":"\\u"+("0000"+s.toString(16)).slice(-4));else if(t||48!=s)if(t||117!=s&&120!=s)a+="\\\\"+String.fromCharCode(s),i+="\\"+String.fromCharCode(s);else{var u=117==s?4:2,l=E.slice(I,I+u);I+=u;var f=parseInt(l,16);isNaN(f)&&m(K.U.lf("invalid unicode or hex escape")),a+="\\"+String.fromCharCode(s)+l,i+=String.fromCharCode(f)}else a+="\\\\x00",i+="\0"}else{if(isNaN(o)){m(K.U.lf("end of file in a string"));break}if(h.rx.isNewline(o)&&!r){m(K.U.lf("new line in a string"));break}i+=String.fromCharCode(o),a+=String.fromCharCode(o)}}var c=p(S.String,i);c.quoted=a,c.stringPrefix=e}function f(){I--,r("")}function c(){p(S.NewLine,""),t()}function t(){for(var e=0;;){var n=E.charCodeAt(I);if(9!=n){if(32!=n)break;e++,I++}else e=e+8&-8,I++}p(S.Indent,""+e)}function y(){var e=E.charCodeAt(I);h.rx.isNewline(e)?(I++,13==e&&10==E.charCodeAt(I)&&I++):m(K.U.lf("unexpected character after line continuation character"))}function v(){for(p(S.NewLine,"");I<E.length&&!h.rx.isNewline(E.charCodeAt(I));)I++;p(S.Comment,E.slice(_+1,I)),13==E.charCodeAt(I)&&10==E.charCodeAt(I+1)&&I++,I++,t()}function k(){var e=E[_],n="";if("0"==e){var r=E[I],t=w[r];if(t){for(I++;;){var i=E[I];if(!t.test(i))break;n+=i,I++}if(n){var a=parseInt(n,P[r]);isNaN(a)&&m(K.U.lf("invalid number")),p(S.Number,e+r+n,a)}else m(K.U.lf("expecting numbers to follow 0b, 0o, 0x"));return}}var o=!1,s=!1,u=!1;for(I=_;;){if(i=E.charCodeAt(I),!u||43!=i&&45!=i)if(u=!1,95==i||x(i));else if(s||o||46!=i){if(s||69!=i&&101!=i)break;u=s=!0}else o=!0;n+=String.fromCharCode(i),I++}!o&&!s&&"0"==e&&1<n.length&&!/^0+/.test(n)&&m(K.U.lf("unexpected leading zero"));var l=parseFloat(n);isNaN(l)&&m(K.U.lf("invalid number")),p(S.Number,n,l)}function g(){x(E.charCodeAt(I))?k():p(S.Op,"Dot")}function x(e){return 48<=e&&e<=57}function T(){m(K.U.lf("invalid token"))}}}(K.py||(K.py={}))}(pxt||(pxt={})),function(Ae){!function(m){var d,a,i,o,s,y,u,v,k,g=!1,x="";function T(){return a[s]}function l(){for(;a[s];s++){var e=a[s];if(e.type!=m.TokenType.Comment){if(0<=d&&e.type==m.TokenType.Op)switch(e.value){case"LParen":case"LSquare":case"LBracket":d++;break;case"RParen":case"RSquare":case"RBracket":d--}if(e.type!=m.TokenType.Error){if(0<d){if(e.type==m.TokenType.NewLine||e.type==m.TokenType.Indent)continue}else if(e.type==m.TokenType.Indent){if(a[s+1].type==m.TokenType.NewLine){s++;continue}var n=parseInt(e.value),r=u[u.length-1];if(n==r)continue;if(r<n)return void u.push(n);e.type=m.TokenType.Dedent;for(var t=0;u.length;){var i=u[u.length-1];if(!(n<i)){for(i!=n&&S(9552,Ae.U.lf("inconsitent indentation"));1<t;)a.splice(s,0,e),t--;return}u.pop(),t++}}return}S(9551,e.value)}else y.push(e)}}function h(){(v=T()).type!=m.TokenType.EOF&&(s++,l())}function S(e,n){n||(n=Ae.U.lf("invalid syntax")),e||(e=9550);var r=T(),t={code:e,category:pxtc.DiagnosticCategory.Error,messageText:Ae.U.lf("{0} near {1}",n,m.friendlyTokenToString(r,i)),fileName:o,start:r.startPos,length:r.endPos?r.endPos-r.startPos:0,line:0,column:0};m.patchPosition(t,i),g&&Ae.log(x+"TS"+e+" "+t.messageText+" at "+(t.line+1)+","+(t.column+1)),k.push(t),9572!=e&&100<k.length&&Ae.U.userError(Ae.U.lf("too many parse errors"))}function n(e,n){var r=T();(r.type==e&&r.value==n||(S(9553,Ae.U.lf("expecting {0}",m.tokenToString({type:e,value:n,startPos:0,endPos:0}))),r.type!=m.TokenType.NewLine))&&h()}function b(){n(m.TokenType.NewLine,"")}function f(e){n(m.TokenType.Keyword,e)}function c(e){n(m.TokenType.Op,e)}function N(){var e=T();return e.type==m.TokenType.Keyword?e.value:""}function E(){var e=T();return e.type==m.TokenType.Op?e.value:""}var C={if:function e(){var n=p("If");h();n.test=V();n.body=t();"elif"==N()?n.orelse=[e()]:n.orelse=A();return U(n)},while:function(){var e=p("While");return f("while"),e.test=V(),e.body=t(),e.orelse=A(),U(e)},for:function(){var e=p("For");return f("for"),e.target=M(),q(e.target),f("in"),e.iter=R(),e.body=t(),e.orelse=A(),U(e)},try:function(){var e=p("Try");f("try"),e.body=t(),e.handlers=[];for(var n=!1;"except"==N();){var r=p("ExceptHandler");e.handlers.push(r),h(),"Colon"!=E()?(n&&S(),r.type=V(),"as"==N()?(h(),r.name=xe()):r.name=void 0):(n=!0,r.type=void 0,r.name=void 0),r.body=t()}e.orelse=A(),0==e.handlers.length&&e.orelse.length&&S();"finally"==N()?(h(),e.finalbody=t()):e.finalbody=[];return U(e)},with:function(){var e=p("With");return f("with"),e.items=ve(Ae.U.lf("with item"),w),e.body=t(),U(e)},def:function(){var e=p("FunctionDef");f("def"),e.name=xe(),c("LParen"),e.args=Q(!0),c("RParen"),e.returns=void 0,"Arrow"==E()&&(h(),e.returns=V());return e.body=t(),U(e)},class:function(){var e=p("ClassDef");if(f("class"),e.name=xe(),"LParen"==E()){var n=Te();e.bases=n.args,e.keywords=n.keywords}else e.bases=[],e.keywords=[];return e.body=t(),U(e)}},r={del:function(){var e=p("Delete");return f("del"),e.targets=ye(Ae.U.lf("expression"),oe),U(e)},pass:function(){var e=p("Pass");return f("pass"),U(e)},break:function(){var e=p("Break");return h(),U(e)},continue:function(){var e=p("Continue");return h(),U(e)},return:function(){var e=p("Return");h(),I()?e.value=void 0:e.value=R();return U(e)},raise:function(){var e=p("Raise");f("raise"),e.exc=void 0,e.cause=void 0,I()||(e.exc=V(),"from"==N()&&(h(),e.cause=V()));return U(e)},global:_,nonlocal:function(){var e=_();return e.kind="Nonlocal",e},import:function(){var e=p("Import");return h(),e.names=ve(Ae.U.lf("import name"),L),U(e)},from:function(){var e=p("ImportFrom");h(),e.level=function(){for(var e=0;;)if("Dot"==E())e+=1,h();else{if("Ellipsis"!=E())return e;e+=3,h()}}(),T().type==m.TokenType.Id?e.module=K():e.module=void 0;e.level||e.module||S();if(f("import"),"Mult"==E()){h();var n=p("Alias");n.name="*",e.names=[n]}else"LParen"==E()?(h(),e.names=ye(Ae.U.lf("import name"),F),c("RParen")):e.names=ye(Ae.U.lf("import name"),F);return U(e)},assert:function(){var e=p("Assert");h(),e.test=V(),"Comma"==E()?(h(),e.msg=V()):e.msg=void 0;return U(e)},yield:function(){T();if(h(),"from"==N()){var e=p("YieldFrom");return e.value=V(),P(U(e))}var n=p("Yield");I()||(n.value=R());return P(U(n))}};function t(){return c("Colon"),function(){{if(T().type==m.TokenType.NewLine){var e=x;g&&(Ae.log(x+"{"),x+="  "),h();var n=void 0;if(T().type!=m.TokenType.Indent)S(9554,Ae.U.lf("expected an indented block")),n=z();else{var r=parseInt(T().value);for(h(),n=z();;){if(T().type==m.TokenType.Dedent){var t=isNaN(r)||parseInt(T().value)<r;if(h(),t)break}if(Ae.U.pushRange(n,z()),T().type==m.TokenType.EOF)break}}return g&&(x=e,Ae.log(x+"}")),n}return G()}}()}function p(e,n){var r=n||T();return{startPos:r.startPos,endPos:r.endPos,kind:e}}function U(e){return e.endPos=v.endPos,e}function A(){return"else"==N()?(h(),t()):[]}function w(){var e=p("WithItem");return e.context_expr=V(),e.optional_vars=void 0,"as"==N()&&(h(),e.optional_vars=oe()),U(e)}function P(e){var n=p("ExprStmt");return n.startPos=e.startPos,n.endPos=e.endPos,n.value=e,n}function I(){var e=T();return e.type==m.TokenType.NewLine||e.type==m.TokenType.Op&&"Semicolon"==e.value}function _(){var e=p("Global");for(h(),e.names=[];e.names.push(xe()),"Comma"==E();)h();return U(e)}function K(){for(var e="";;){if(e+=xe(),"Dot"!=E())return e;e+=".",h()}}function L(){var e=p("Alias");return e.name=K(),"as"==N()?(h(),e.asname=xe()):e.asname=void 0,U(e)}function F(){var e=p("Alias");return e.name=xe(),"as"==N()?(h(),e.asname=xe()):e.asname=void 0,U(e)}function D(e,n){var r=p("Tuple",e);return r.elts=n,U(r)}function e(e){var n=T(),r=ye(Ae.U.lf("expression"),e),t=r[0];return 1!=r.length?D(n,r):t}function O(){return e(ue)}function R(){return e(V)}function M(){return e(oe)}function q(e){"Tuple"==e.kind?e.elts.forEach(q):e.ctx="Store"}function B(){var e=Ae.U.lookup(r,N());return e?e():function(){var e=T(),n=O(),r=E();if("Assign"==r){var t=p("Assign");for(t.targets=[n];;){if(h(),n=O(),"Assign"!=(r=E())){t.value=n;break}t.targets.push(n)}return t.targets.forEach(q),U(t)}if("Colon"==r){var i=p("AnnAssign");return i.target=n,h(),i.annotation=V(),"Assign"==E()&&(h(),i.value=V()),i.simple=e.type==m.TokenType.Id&&"Name"==n.kind?1:0,q(i.target),U(i)}if(Ae.U.endsWith(r,"Assign")){var a=p("AugAssign");return a.target=n,a.op=r.replace("Assign",""),h(),a.value=R(),q(a.target),U(a)}if("Semicolon"==r||T().type==m.TokenType.NewLine){var o=p("ExprStmt");return o.value=n,U(o)}return S(9555,Ae.U.lf("unexpected token")),h(),null}()}function G(){for(var e=[B()];"Semicolon"==E()&&(h(),T().type!=m.TokenType.NewLine);)e.push(B());return b(),e.filter(function(e){return!!e})}function z(){var e=k.length,n=T().type==m.TokenType.Indent;n&&(h(),S(9573,Ae.U.lf("unexpected indent")));for(var r=[];"MatMult"==E();)h(),r.push(Se()),b();var t=N(),i=Ae.U.lookup(C,N()),a=[],o=y;(y=[],"class"==t||"def"==t)?((p=i()).decorator_list=r,a=[p]):r.length?S(9556,Ae.U.lf("decorators not allowed here")):a=i?[i()]:G();o.length&&a.length&&(a[0]._comments=o);var s,u,l=[];if(k.length>e){for(d=-1;v.type!=m.TokenType.Dedent&&v.type!=m.TokenType.NewLine&&(h(),g&&l.push(m.tokenToString(T())),T().type!=m.TokenType.EOF););n&&T().type===m.TokenType.Dedent&&h(),d=0,g&&Ae.log(x+"skip: "+l.join(", "))}if(g)for(var f=0,c=a;f<c.length;f++){var p=c[f];s="stmt",u=p,g&&Ae.log(x+s+": "+u.kind)}return a}function Q(n){var e=p("Arguments");for(e.args=[],e.defaults=[],e.kwonlyargs=[],e.kw_defaults=[],e.vararg=void 0;;){var r=E();if("Colon"==r||"RParen"==r)break;if("Mult"==r)e.vararg&&S(9557,Ae.U.lf("multiple *arg")),h(),T().type==m.TokenType.Id?e.vararg=a():e.vararg=void 0;else if("Pow"==r)e.kwarg&&S(9558,Ae.U.lf("multiple **arg")),h(),e.kwarg=a();else{e.kwarg&&S(9559,Ae.U.lf("arguments after **"));var t=a(),i=void 0;"Assign"==E()&&(h(),i=V()),void 0!==e.vararg&&i?(e.kwonlyargs.push(t),e.kw_defaults.push(i)):(e.args.push(t),i?e.defaults.push(i):e.defaults.length&&S(9560,Ae.U.lf("non-default argument follows default argument")))}if("Comma"!=E())break;h()}return e.kwarg||(e.kwarg=void 0),e.vararg||(e.vararg=void 0),U(e);function a(){var e=p("Arg");return e.arg=xe(),e.annotation=void 0,n&&"Colon"==E()&&(h(),e.annotation=V()),e}}function j(e){var n=p("Lambda");return h(),n.args=Q(!1),c("Colon"),n.body=e?le():V(),U(n)}function V(){if("lambda"==N())return j();var e=T(),n=$();if("if"==N()){var r=p("IfExp",e);return r.body=n,f("if"),r.test=$(),f("else"),r.orelse=V(),U(r)}return n}function W(e,n){var r=T(),t=n();if(N()==e){var i=p("BoolOp",r);for(i.op="or"==e?"Or":"And",i.values=[t];N()==e;)f(e),i.values.push(n());return U(i)}return t}function H(){return W("and",J)}function $(){return W("or",H)}function J(){if("not"==N()){var e=p("UnaryOp");return h(),e.op="Not",e.operand=J(),U(e)}return function(){var e=T(),n=oe();if(!Y())return n;var r=p("Compare",e);r.left=n,r.comparators=[],r.ops=[];for(;;){var t=Y();if(!t)break;h(),"NotIn"==t?f("in"):"Is"==t&&"not"==N()&&(h(),t="IsNot"),r.ops.push(t),r.comparators.push(oe())}return U(r)}()}var X={Lt:"Lt",Gt:"Gt",Eq:"Eq",GtE:"GtE",LtE:"LtE",NotEq:"NotEq",in:"In",not:"NotIn",is:"Is"};function Y(){return X[E()]||X[N()]||null}var Z={Invert:"Invert",Sub:"USub",Add:"UAdd"};function ee(e,n){for(var r=T(),t=e();;){var i=E();if(!(i&&0<=n.indexOf(","+i+",")))return t;var a=p("BinOp",r);a.left=t,a.op=i,h(),a.right=e(),t=a}}function ne(){return ee(be,",Mult,MatMult,Div,Mod,FloorDiv,")}function re(){return ee(ne,",Add,Sub,")}function te(){return ee(re,",LShift,RShift,")}function ie(){return ee(te,",BitAnd,")}function ae(){return ee(ie,",BitXor,")}function oe(){return ee(ae,",BitOr,")}function se(){var e=T(),n=void 0;if("Colon"!=E()&&(n=V()),"Colon"==E()){var r;(r=p("Slice",e)).lower=n,h();var t=E();return r.upper="Colon"!=t&&"Comma"!=t&&"RSquare"!=t?V():void 0,r.step=void 0,"Colon"==E()&&(h(),"Comma"!=(t=E())&&"RSquare"!=t&&(r.step=V())),U(r)}return n||S(9570,Ae.U.lf("unable to parse lower subscript")),(r=p("Index")).value=n,U(r)}function ue(){if("Mult"==E()){var e=p("Starred");return e.value=oe(),U(e)}return V()}function le(){return"lambda"==N()?j(!0):$()}function fe(){for(var e=[];;){var n=p("Comprehension");for(n.is_async=0,e.push(n),f("for"),n.target=M(),q(n.target),f("in"),n.iter=$(),n.ifs=[];"if"==N();)h(),n.ifs.push(le());if("for"!=N())return e}}function ce(){var e=T();if("Mult"==E()){var n=p("Starred");return h(),n.value=V(),U(n)}if("Pow"==E()){n=p("Keyword");return h(),n.arg=void 0,n.value=V(),U(n)}var r=V();return"Assign"==E()?("Name"!=r.kind&&S(9561,Ae.U.lf("invalid keyword argument; did you mean ==?")),h(),(n=p("Keyword",e)).arg=r.id||"???",n.value=V(),U(n)):"for"==N()?((n=p("GeneratorExp",e)).elt=r,n.generators=fe(),U(n)):r}function pe(){var e=p("NameConstant");return e.value=null,h(),U(e)}function me(){var e=T();if(e.type==m.TokenType.Id){var n=p("Name");return h(),n.id=e.value,n.ctx="Load",U(n)}if(e.type==m.TokenType.Number){n=p("Num");return h(),n.ns=e.value,n.n=e.auxValue,U(n)}if(e.type==m.TokenType.String){h();for(var r=e.value;T().type==m.TokenType.String;)r+=T().value,h();return"b"==e.stringPrefix?(n=p("Bytes",e)).s=Ae.U.toArray(Ae.U.stringToUint8Array(r)):(n=p("Str",e)).s=r,U(n)}if(e.type==m.TokenType.Keyword){if("None"==e.value||"True"==e.value||"False"==e.value){n=p("NameConstant");return h(),n.value="True"==e.value||"False"!=e.value&&null,U(n)}return S(9564,Ae.U.lf("expecting atom")),pe()}if(e.type==m.TokenType.Op){var t=e.value;return"LParen"==t?ge("RParen","Tuple","GeneratorExp"):"LSquare"==t?ge("RSquare","List","ListComp"):"LBracket"==t?function(){var s=T();if(h(),"Pow"==E())return h(),r(void 0,oe());if("RBracket"==E()){var e=p("Dict",s);return h(),e.keys=[],e.values=[],U(e)}var n=ue();return"Starred"!=n.kind&&"Colon"==E()?(h(),r(n,V())):function(e){if("for"==N()){"Starred"==e.kind&&S(9562,Ae.U.lf("iterable unpacking cannot be used in comprehension"));var n=p("SetComp",s);return n.elt=e,n.generators=fe(),U(n)}var r=p("Set",s);if(r.elts=[e],"Comma"==E()){var t=ke("RBracket",Ae.U.lf("set element"),ue);r.elts=[e].concat(t)}else c("RBracket");return U(r)}(n);function u(){if("Pow"==E())return h(),[null,oe()];var e=V();return c("Colon"),[e,V()]}function r(e,n){if("for"==N()){e||S(9563,Ae.U.lf("dict unpacking cannot be used in dict comprehension"));var r=p("DictComp",s);return r.key=e,r.value=n,r.generators=fe(),U(r)}var t=p("Dict",s);if(t.keys=[e],t.values=[n],"Comma"==E())for(var i=0,a=ke("RBracket",Ae.U.lf("dict element"),u);i<a.length;i++){var o=a[i];2<=o.length&&o[0]&&o[1]&&(t.keys.push(o[0]),t.values.push(o[1]))}else c("RBracket");return U(t)}}():(S(9565,Ae.U.lf("unexpected operator")),pe())}return S(9566,Ae.U.lf("unexpected token")),pe()}function de(){var e=E();return"RParen"==e||"RSquare"==e||"RBracket"==e||"Colon"==e||"Semicolon"==e||(!!Ae.U.endsWith(e,"Assign")||("in"==N()||T().type==m.TokenType.NewLine))}function ye(e,n){var r=[];if(de())return r;for(;;){r.push(n());var t="Comma"==E();if(t&&h(),de())return r;if(!t)return S(9567,Ae.U.lf("expecting {0}",e)),r}}function ve(e,n){for(var r=[];r.push(n()),"Comma"==E();)h();return r}function ke(e,n,r){h();var t=[];if(E()!=e)for(;;){t.push(r());var i="Comma"==E();if(i&&h(),E()==e)break;if(!i){S(9568,Ae.U.lf("expecting {0}",n));break}}return c(e),t}function ge(e,n,r){var t=T();if(h(),E()==e)return h(),(a=p(n,t)).elts=[],U(a);var i=ue();if("for"==N())return(a=p(r,t)).elt=i,a.generators=fe(),c(e),U(a);if("Comma"==E()){var a=p(n,t);return h(),a.elts=ye(Ae.U.lf("expression"),ue),a.elts.unshift(i),c(e),U(a)}return c(e),"List"==n?((a=p(n,t)).elts=[i],U(a)):i}function xe(){var e=T();return e.type!=m.TokenType.Id&&S(9569,Ae.U.lf("expecting identifier")),h(),e.value}function Te(){for(var e=[],n=[],r=0,t=ke("RParen",Ae.U.lf("argument"),ce);r<t.length;r++){var i=t[r];"Keyword"==i.kind?n.push(i):(n.length&&S(9570,Ae.U.lf("positional argument follows keyword argument")),e.push(i))}return{args:e,keywords:n}}function he(e,n){var r=E();if("LParen"==r){(i=p("Call",e)).func=n;var t=Te();return i.args=t.args,i.keywords=t.keywords,U(i)}if("LSquare"==r){var i,a=T();(i=p("Subscript",e)).value=n;var o=ke("RSquare",Ae.U.lf("subscript"),se);if(0==o.length)S(9571,Ae.U.lf("need non-empty index list"));else if(1==o.length)i.slice=o[0];else if(o.every(function(e){return"Index"==e.kind})){var s=o[0];s.value=D(a,o.map(function(e){return e.value})),i.slice=s}else{var u=p("ExtSlice",a);u.dims=o,i.slice=U(u)}return U(i)}return"Dot"==r?((i=p("Attribute",e)).value=n,h(),i.attr=xe(),U(i)):n}function Se(){for(var e=T(),n=me();;){var r=he(e,n);if(r===n)return n;n=r}}function be(){if(Z[E()]){var e=p("UnaryOp");return e.op=Z[E()],h(),e.operand=be(),U(e)}return function(){T();var e=Se();if("Pow"==E()){var n=p("BinOp");return h(),n.left=e,n.op="Pow",n.right=be(),U(n)}return e}()}var Ne={kind:1,id:2,n:3,s:4,func:5,key:6,elt:7,elts:8,keys:9,left:10,ops:11,comparators:12,names:13,items:14,test:15,targets:16,dims:17,context_expr:18,name:19,bases:20,type:21,inClass:22,target:23,annotation:24,simple:25,op:26,operand:27,right:28,values:29,iter:30,ifs:31,is_async:32,value:33,slice:34,attr:35,generators:36,args:37,keywords:38,body:39,handlers:40,orelse:41,finalbody:42,decorator_list:43,kwonlyargs:44,kw_defaults:45,defaults:46,arg:47},Ee={lineno:1,col_offset:1,startPos:1,endPos:1,kind:1},Ce={body:1,orelse:1,finalbody:1},Ue={_comments:1,ctx:1,ns:1};m.dump=function(e,y){void 0===y&&(y=!1);for(var v=function(e,n){if(Array.isArray(n)){for(var r="",t=0;t<n.length;++t)0<t&&(r+=", "),r+=v(e,n[t]);return"["+r+"]"}if(!n||!n.kind)return JSON.stringify(n);var i="",a=Object.keys(n);a.sort(function(e,n){return(Ne[e]||100)-(Ne[n]||100)||Ae.U.strcmp(e,n)});for(var o=0,s=a;o<s.length;o++){var u=s[o];if(!(Ae.U.lookup(Ee,u)||y&&Ae.U.lookup(Ue,u)))if(i&&(i+=", "),i+=u+"=",Array.isArray(n[u])&&n[u].length&&Ae.U.lookup(Ce,u)){i+="[\n";for(var l=e+"  ",f=0,c=n[u];f<c.length;f++){var p=c[f];i+=l+v(l,p)+"\n"}i+=e+"]"}else if("_comments"==u){i+="[\n",l=e+"  ";for(var m=0,d=n[u];m<d.length;m++)p=d[m],i+=l+JSON.stringify(p.value)+"\n";i+=e+"]"}else i+=v(e,n[u])}return n.kind+"("+i+")"},n="",r=0,t=e;r<t.length;r++){var i=t[r];n+=v("",i)+"\n"}return n},m.parse=function(e,n,r){i=e,o=n,a=r,y=[],u=[s=d=0],k=[];var t=[];try{if(v=a[0],l(),T().type!=m.TokenType.EOF)for(t=z();T().type!=m.TokenType.EOF;)Ae.U.pushRange(t,z())}catch(e){S(9572,Ae.U.lf("exception: {0}",e.message))}return{stmts:t,diagnostics:k}}}(Ae.py||(Ae.py={}))}(pxt||(pxt={})),function(W){!function(j){function V(e,n,r){var t={fileName:e.getSourceFile().fileName,start:e.getStart(),length:e.getEnd()-e.getStart(),line:void 0,column:void 0,code:n,category:pxtc.DiagnosticCategory.Error,messageText:r},i=new Error(r);throw i.pyDiagnostic=t,i}function e(n){return function(e){return""+j.INDENT.repeat(n)+e}}j.decompileToPython=function(e,n){var r={blocksInfo:void 0,outfiles:{},diagnostics:[],success:!0,times:{}};try{var t=function(e,r){var n,v=e.getTypeChecker(),t=(new ts.pxtc.LSHost(e),e.getSourceFile(r)),i=pxtc.decompiler.buildCommentMap(t),a=W.U.toSet(["ArithmeticError","AssertionError","AttributeError","BaseException","BlockingIOError","BrokenPipeError","BufferError","BytesWarning","ChildProcessError","ConnectionAbortedError","ConnectionError","ConnectionRefusedError","ConnectionResetError","DeprecationWarning","EOFError","Ellipsis","EnvironmentError","Exception","False","FileExistsError","FileNotFoundError","FloatingPointError","FutureWarning","GeneratorExit","IOError","ImportError","ImportWarning","IndentationError","IndexError","InterruptedError","IsADirectoryError","KeyError","KeyboardInterrupt","LookupError","MemoryError","NameError","None","NotADirectoryError","NotImplemented","NotImplementedError","OSError","OverflowError","PendingDeprecationWarning","PermissionError","ProcessLookupError","RecursionError","ReferenceError","ResourceWarning","RuntimeError","RuntimeWarning","StopAsyncIteration","StopIteration","SyntaxError","SyntaxWarning","SystemError","SystemExit","TabError","TimeoutError","True","TypeError","UnboundLocalError","UnicodeDecodeError","UnicodeEncodeError","UnicodeError","UnicodeTranslateError","UnicodeWarning","UserWarning","ValueError","Warning","ZeroDivisionError","_","__build_class__","__debug__","__doc__","__import__","__loader__","__name__","__package__","__spec__","abs","all","any","ascii","bin","bool","bytearray","bytes","callable","chr","classmethod","compile","complex","copyright","credits","delattr","dict","dir","divmod","enumerate","eval","exec","exit","filter","float","format","frozenset","getattr","globals","hasattr","hash","help","hex","id","input","int","isinstance","issubclass","iter","len","license","list","locals","map","max","memoryview","min","next","object","oct","open","ord","pow","print","property","quit","range","repr","reversed","round","set","setattr","slice","sorted","staticmethod","str","sum","super","tuple","type","vars","zip"],function(e){return e}),o=ts.pxtc.decompiler.buildRenameMap(e,t,a),s=o[0],m=o[1],u=pxtc.getApiInfo(e),y=W.U.mapMap(u.byQName,function(e,n){return n.fileName==r?void 0:n}),k=j.computeScopeVariableLookup(t);return n=t.getChildren().map(x).reduce(function(e,n){return e.concat(n)},[]).reduce(function(e,n){return n||e[e.length-1]?__spreadArrays(e,[n]):e},[]),i.filter(function(e){return!e.owner}).forEach(function(e){return n.push.apply(n,f(e))}),n.join("\n");function P(e){if(!e.getSourceFile())return null;var n=e.getText(),r=v.getSymbolAtLocation(e);r&&(n=v.getFullyQualifiedName(r));var t=y[n];if(t&&t.attributes.alias)return t.attributes.alias;if(t&&t.pyQName){if(t.isInstance){if(ts.isPropertyAccessExpression(e))return null;var i=new RegExp("(?:^|.)"+t.namespace+".(.+)"),a=i.exec(t.pyQName);if(a)return a[1]}return t.pyQName}return n in pxtc.ts2PyFunNameMap?pxtc.ts2PyFunNameMap[n].n:null}function I(e){var n=P(e);if(n)return n;if(!ts.isIdentifier(e))return V(e,3001,"Unsupported advanced name format: "+e.getText());var r=e.text,t=e.getSourceFile();if(s&&t){var i=s.getRenameForPosition(e.getStart());i&&(r=i.name)}return r}function g(e,n){return 0!=(e.flags&n)}function l(e,n){var r=v.getTypeAtLocation(e);return g(r,n)}function _(e){return l(e,ts.TypeFlags.StringLike)}function S(e){return l(e,ts.TypeFlags.NumberLike)}function x(e){switch(e.kind){case ts.SyntaxKind.SyntaxList:return e._children.map(x).reduce(function(e,n){return e.concat(n)},[]);case ts.SyntaxKind.EndOfFileToken:case ts.SyntaxKind.OpenBraceToken:case ts.SyntaxKind.CloseBraceToken:return[];default:return r=b(n=e),pxtc.decompiler.getCommentsForStatement(n,i).map(f).reduce(function(e,n){return e.concat(n)},[]).concat(r)}var n,r}function f(e){var n=[];if(e.kind===pxtc.decompiler.CommentKind.SingleLine)n.push("# "+e.text);else{n.push('"""');for(var r=0,t=e.lines;r<t.length;r++){var i=t[r];n.push(i)}n.push('"""')}return n}function b(e){return ts.isVariableStatement(e)?e.declarationList.declarations.map(w).reduce(function(e,n){return e.concat(n)},[]):ts.isClassDeclaration(e)?function(e){var n=[];if(!e.name)return V(e,3011,"Unsupported: anonymous class");var r=e.members.every(T),t=I(e.name);r?n.push("class "+t+"(Enum):"):n.push("class "+t+":");var i=e.members.map(h).reduce(function(e,n){return e.concat(n)},[]).filter(function(e){return e});return i.length&&(n=n.concat(i.map(j.indent1))),n}(e):ts.isEnumDeclaration(e)?function(e){var n=[];n.push("class "+I(e.name)+"(Enum):");var r=e.members.every(function(e){return!!e.initializer}),t=!e.members.every(function(e){return!!e.initializer});if(!r&&!t)return V(e,3005,"Unsupported enum decleration: has mixture of explicit and implicit initialization");if(r)return V(e,3006,"Unsupported: explicit enum initialization");for(var i=0,a=0,o=e.members;a<o.length;a++){var s=o[a];n.push(j.indent1(I(s.name)+" = "+i++))}return n}(e):ts.isExpressionStatement(e)?function(e){var n=E(e.expression);if(n)return n;var r=Q(e.expression),t=r[0],i=r[1];return i.length?__spreadArrays([""],i,t,[""]):__spreadArrays(i,t)}(e):ts.isFunctionDeclaration(e)?U(e):ts.isIfStatement(e)?(p=function e(n){var r=[],t=Q(n.expression),i=t[0],a=t[1];r=r.concat(a);var o="if "+L(i)+":",s=[],u=N(n.thenStatement);if(s=s.concat(u),n.elseStatement)if(ts.isIfStatement(n.elseStatement)){var l=e(n.elseStatement),f=l.supportStmts,c=l.ifStmt,p=l.rest,m="el"+c;r=r.concat(f),s.push(m),s=s.concat(p)}else{s.push("else:");var d=N(n.elseStatement);s=s.concat(d)}return{supportStmts:r,ifStmt:o,rest:s}}(e),m=p.supportStmts,d=p.ifStmt,y=p.rest,m.concat([d]).concat(y)):ts.isForStatement(e)?function(e){var n=function(e){if(!e.initializer)return null;if(e.initializer.kind!==ts.SyntaxKind.VariableDeclarationList)return null;var n=e.initializer;if(1!==n.declarations.length)return null;var r=n.declarations[0],t=I(r.name);if(!r.initializer||!function n(e,r){var t=function(e){return n(e,r)};return ts.isBinaryExpression(e)?t(e.left)&&t(e.right):ts.isPropertyAccessExpression(e)?t(e.expression):ts.isPrefixUnaryExpression(e)||ts.isPostfixUnaryExpression(e)?e.operator!==ts.SyntaxKind.PlusPlusToken&&e.operator!==ts.SyntaxKind.MinusMinusToken&&t(e.operand):ts.isParenthesizedExpression(e)?t(e.expression):ts.isArrayLiteralExpression(e)?e.elements.map(t).reduce(function(e,n){return e&&n},!0):ts.isElementAccessExpression(e)?t(e.expression)&&(!e.argumentExpression||t(e.argumentExpression)):r(e)}(r.initializer,function(e){switch(e.kind){case ts.SyntaxKind.PropertyAccessExpression:case ts.SyntaxKind.BinaryExpression:case ts.SyntaxKind.ParenthesizedExpression:case ts.SyntaxKind.ArrayLiteralExpression:case ts.SyntaxKind.ElementAccessExpression:case ts.SyntaxKind.TrueKeyword:case ts.SyntaxKind.FalseKeyword:case ts.SyntaxKind.NullKeyword:case ts.SyntaxKind.UndefinedKeyword:case ts.SyntaxKind.NumericLiteral:case ts.SyntaxKind.StringLiteral:case ts.SyntaxKind.NoSubstitutionTemplateLiteral:return!0;case ts.SyntaxKind.CallExpression:case ts.SyntaxKind.NewExpression:case ts.SyntaxKind.FunctionExpression:case ts.SyntaxKind.ArrowFunction:case ts.SyntaxKind.Identifier:case ts.SyntaxKind.ThisKeyword:return!1;case ts.SyntaxKind.PrefixUnaryExpression:case ts.SyntaxKind.PostfixUnaryExpression:var n=e;return n.operator!==ts.SyntaxKind.PlusPlusToken&&n.operator!==ts.SyntaxKind.MinusMinusToken}return!1})||!S(r.initializer))return null;var i=Q(r.initializer),a=i[0];if(i[1].length)return null;var o=L(a);if(!e.condition)return null;if(!ts.isBinaryExpression(e.condition))return null;if(!ts.isIdentifier(e.condition.left))return null;if(I(e.condition.left)!=t)return null;if(!S(e.condition.right))return null;var s=Q(e.condition.right),u=s[0];if(s[1].length)return null;var l,f,c=L(u),p=c;if(e.condition.operatorToken.kind===ts.SyntaxKind.LessThanEqualsToken&&(l=c,(f=Math.floor(Number(l)))!==1/0&&String(f)===l))p=""+(Number(c)+1);else if(e.condition.operatorToken.kind!==ts.SyntaxKind.LessThanToken)return null;return e.incrementor&&(ts.isPostfixUnaryExpression(e.incrementor)||ts.isPrefixUnaryExpression(e.incrementor))?e.incrementor.operator!==ts.SyntaxKind.PlusPlusToken?null:o<p?{name:t,fromIncl:o,toExcl:p}:null:null}(e);if(n){var r=n.name,t=n.fromIncl,i=n.toExcl,a="0"===t?"for "+r+" in range("+i+"):":"for "+r+" in range("+t+", "+i+"):",o=N(e.statement);return[a].concat(o)}var s,u=[];if(e.initializer)if(ts.isVariableDeclarationList(e.initializer)){var l=e.initializer.declarations.map(w).reduce(function(e,n){return e.concat(n)},[]);u=u.concat(l)}else{var f=Q(e.initializer),c=f[0],p=f[1];u=u.concat(p).concat(c)}if(e.condition){var m=Q(e.condition),d=m[0],y=m[1];u=u.concat(y),s=L(d)}else s="True";var v="while "+s+":";u.push(v);var k=b(e.statement).map(j.indent1);if(0!==k.length||e.incrementor||(k=[j.indent1("pass")]),u=u.concat(k),e.incrementor){var g=E(e.incrementor);if(g)u=u.concat(g.map(j.indent1));else{var x=Q(e.incrementor),T=x[0],h=x[1];u=u.concat(h).concat(T.map(j.indent1))}}return u}(e):ts.isForOfStatement(e)?function(e){if(!ts.isVariableDeclarationList(e.initializer))return V(e,3003,"Unsupported expression in for..of initializer: "+e.initializer.getText());var n=e.initializer.declarations.map(function(e){return I(e.name)});if(1!==n.length)return V(e,3004,"Unsupported multiple declerations in for..of: "+e.initializer.getText());var r=n[0],t=Q(e.expression),i=t[0],a=t[1];a=a.concat(F("for "+r+" in ",i,":"));var o=N(e.statement);return a=a.concat(o)}(e):ts.isWhileStatement(e)?(s=Q((o=e).expression),u=s[0],l=s[1],f=N(o.statement),c=F("while ",u,":"),l.concat(c).concat(f)):ts.isReturnStatement(e)?function(e){if(!e.expression)return["return"];var n=Q(e.expression),r=n[0],t=n[1],i=F("return ",r);return t.concat(i)}(e):ts.isBlock(e)?C(e):ts.isTypeAliasDeclaration(e)?(i=e,a=pxtc.emitPyTypeFromTypeNode(i.type),[I(i.name)+" = "+a]):ts.isEmptyStatement(e)?[]:ts.isModuleDeclaration(e)?(r=I((n=e).name),t=n.body&&n.body.getChildren().map(x).reduce(function(e,n){return e.concat(n)},[]).map(function(e){return j.indent1(e)}),["@namespace","class "+r+":"].concat(t||[])):ts.isBreakStatement(e)?["break"]:ts.isContinueStatement(e)?["continue"]:V(e,3002,"Not implemented: "+ts.SyntaxKind[e.kind]+" ("+e.kind+")");var n,r,t,i,a,o,s,u,l,f,c,p,m,d,y}function N(e){var n=b(e).map(j.indent1);return n.length<1&&(n=[j.indent1("pass")]),n}function T(e){if(e.kind!==ts.SyntaxKind.PropertyDeclaration)return!1;var n=e;if(!n.modifiers||1!==n.modifiers.length)return!1;for(var r=0,t=n.modifiers;r<t.length;r++){var i=t[r];if(i.kind!==ts.SyntaxKind.StaticKeyword)return!1}return!!n.initializer&&n.initializer.kind===ts.SyntaxKind.NumericLiteral}function h(e){switch(e.kind){case ts.SyntaxKind.PropertyDeclaration:return function(e){var n=I(e.name);if(e.initializer){var r=Q(e.initializer),t=r[0],i=r[1];return i.concat([n+" = "+L(t)])}return[]}(e);case ts.SyntaxKind.MethodDeclaration:case ts.SyntaxKind.Constructor:return U(e);default:return["# unknown ClassElement "+e.kind]}}function E(e){if(n=e,!ts.isPrefixUnaryExpression(n)&&!ts.isPostfixUnaryExpression(n)||n.operator!==ts.SyntaxKind.MinusMinusToken&&n.operator!==ts.SyntaxKind.PlusPlusToken)return null;var n,r=Q(e.operand),t=r[0],i=r[1],a=e.operator===ts.SyntaxKind.MinusMinusToken?" -= 1":" += 1",o=i;return o.push(""+L(t)+a),o}function C(e){var n=e.getChildren().map(x).reduce(function(e,n){return e.concat(n)},[]);return n}function U(e,n,r,t){var i=[];e.kind!==ts.SyntaxKind.MethodDeclaration&&e.kind!==ts.SyntaxKind.Constructor||i.push("self");var a,o=r?B(e.parameters,r):e.parameters,s=o.map(function(e){return A(e,!t)}),u=(i=i.concat(s)).join(", "),l=[];if(e.kind===ts.SyntaxKind.Constructor)a="__init__";else if(n)a=n;else{if(!e.name)return V(e,3012,"Unsupported: anonymous function decleration");a=I(e.name)}if(l.push("def "+a+"("+u+"):"),!e.body)return V(e,3013,"Unsupported: function decleration without body");var f=[];if(ts.isBlock(e.body))f=C(e.body);else{var c=Q(e.body),p=c[0],m=c[1];(f=f.concat(m)).concat(p)}if(f.length){var d=k.getExplicitGlobals(e).map(function(e){return I(e)});d&&d.length&&f.unshift("global "+d.join(", "));var y=k.getExplicitNonlocals(e).map(function(e){return I(e)});y&&y.length&&f.unshift("nonlocal "+y.join(", ")),l=l.concat(f.map(j.indent1))}else l.push(j.indent1("pass"));return l}function A(e,n){void 0===n&&(n=!0);var r=e.altName||I(e.name),t="";if(e.type&&n){var i=pxtc.emitPyTypeFromTypeNode(e.type);i&&-1===i.indexOf("(TODO")&&(t=": "+i)}var a="";if(e.initializer){var o=Q(e.initializer),s=o[0],u=o[1];if(u.length)return V(e,3007,"TODO: complex expression in parameter default value not supported. Expression: "+e.initializer.getText());a=" = "+L(s)}return""+r+t+a}function w(e){var n=[],r=I(e.name);if(e.initializer){var t=Q(e.initializer),i=t[0],a=t[1];n=n.concat(a);var o=void 0;if(e.type){var s=pxtc.emitPyTypeFromTypeNode(e.type);o=r+": "+s+" = "+L(i)}else o=r+" = "+L(i);return n.push(o),n}return n}function K(e,n){return[[e],n||[]]}function L(e,n){return void 0===n&&(n="\n"),e.join(n)}function F(e,n,r){return void 0===e&&(e=""),void 0===r&&(r=""),n[0]=e+n[0],n[n.length-1]=n[n.length-1]+r,n}function D(e,n){switch(e){case ts.SyntaxKind.BarBarToken:return"or";case ts.SyntaxKind.AmpersandAmpersandToken:return"and";case ts.SyntaxKind.ExclamationToken:return"not";case ts.SyntaxKind.LessThanToken:return"<";case ts.SyntaxKind.LessThanEqualsToken:return"<=";case ts.SyntaxKind.GreaterThanToken:return">";case ts.SyntaxKind.GreaterThanEqualsToken:return">=";case ts.SyntaxKind.EqualsEqualsEqualsToken:case ts.SyntaxKind.EqualsEqualsToken:return"==";case ts.SyntaxKind.ExclamationEqualsEqualsToken:case ts.SyntaxKind.ExclamationEqualsToken:return"!=";case ts.SyntaxKind.EqualsToken:return"=";case ts.SyntaxKind.PlusToken:return"+";case ts.SyntaxKind.MinusToken:return"-";case ts.SyntaxKind.AsteriskToken:return"*";case ts.SyntaxKind.PlusEqualsToken:return"+=";case ts.SyntaxKind.MinusEqualsToken:return"-=";case ts.SyntaxKind.PercentToken:return"%";case ts.SyntaxKind.SlashToken:return"/";case ts.SyntaxKind.PlusPlusToken:case ts.SyntaxKind.MinusMinusToken:return V(n,3008,"Unsupported ++ and -- in an expression (not a statement or for loop)");case ts.SyntaxKind.AmpersandToken:return"&";case ts.SyntaxKind.CaretToken:return"^";case ts.SyntaxKind.LessThanLessThanToken:return"<<";case ts.SyntaxKind.GreaterThanGreaterThanToken:return">>";case ts.SyntaxKind.GreaterThanGreaterThanGreaterThanToken:return V(n,3009,"Unsupported operator: >>>");case ts.SyntaxKind.AsteriskAsteriskToken:return"**";case ts.SyntaxKind.AsteriskAsteriskEqualsToken:return"**=";case ts.SyntaxKind.PercentEqualsToken:return"%=";case ts.SyntaxKind.AsteriskEqualsToken:return"*=";case ts.SyntaxKind.SlashEqualsToken:return"/=";default:return W.tickEvent("depython.todo",{op:e}),V(n,3008,"Unsupported Python operator (code: "+e+")")}}function O(e){if(ts.isPropertyAccessExpression(e)){var n=I(e.name);return ts.isIdentifier(e.expression)?(0<=n.indexOf(".")&&(n=n.substr(n.lastIndexOf(".")+1)),[n]):O(e.expression).concat([n])}return ts.isIdentifier(e)?[I(e)]:[]}function R(t){var e=t.join(", ");return 60<e.length&&1<t.length?t.map(function(e,n){var r=","==e.charAt(e.length-1)?"":",";return 0==n?e+r:n==t.length-1?j.indent1(e):j.indent1(e+r)}):[e]}function M(e,n,r,t,i){if((ts.isFunctionExpression(e)||ts.isArrowFunction(e))&&n&&n.type&&ts.isFunctionTypeNode(n.type)){var a=void 0,o=function(e,n,r,t){var i="";n&&(i=O(n).map(pxtc.snakify).join("_"));var a=[];if(r&&1<r.length&&t&&1<t.length)for(var o=0;o<r.length&&o<t.length;o++){var s=t[o],u=v.getTypeAtLocation(s);if(g(u,ts.TypeFlags.EnumLike)){var l=O(s).map(pxtc.snakify);a=a.concat(l)}}var f=a.join("_"),c="";i||f||!e||(c=I(e.name));var p=([i,f,c].filter(function(e){return e}).map(pxtc.snakify).map(function(e){return e.toLowerCase()}).join("_")||"my_callback").split("_");4<p.length&&(p=function(e){for(var n={},r=[],t=0,i=e;t<i.length;t++){var a=i[t];a in n||(n[a]=!0,r.push(a))}return r}(p));for(var m=W.U.toDictionary(["any","on","event"],function(e){return e});2<p.length;){var d=y(p,m);if(d.length==p.length)break;p=d}return(p=__spreadArrays(["on"],p)).join("_");function y(e,n){for(var r=[],t=!1,i=0,a=e;i<a.length;i++){var o=a[i];o in n&&!t?t=!0:r.push(o)}return r}}(n,r,t,i);return G(e,o,a,!0)}return Q(e)}function q(t){var e=v.getTypeAtLocation(t.expression),n=v.typeToTypeNode(e),i=ts.createNodeArray([]);if(ts.isFunctionTypeNode(n)&&(i=n.parameters,t.arguments&&i.length<t.arguments.length))return W.tickEvent("depython.todo",{kind:t.kind}),V(t,3010,"TODO: Unsupported call site where caller the arguments outnumber the callee parameters: "+t.getText());var r=function(e){if(!e.getSourceFile())return null;var n=e.getText();return y[n]||null}(t.expression);if(t.arguments&&r&&"TD_ID"==r.attributes.shim)return Q(t.arguments[0]);var a=Q(t.expression),o=a[0],s=a[1],u=L(o),l=t.arguments||ts.createNodeArray(),f=l.map(function(e,n,r){return M(e,i[n],t.expression,i,r)}),c=f.map(function(e){e[0];var n=e[1];return n}).reduce(function(e,n){return e.concat(n)},s);if(0===u.indexOf("_py.py_")){if(f.length<=0)return V(t,3014,"Unsupported: call expression has no arguments for _py.py_ fn");u=u.substr(7).split("_").filter(function(e,n){return 0!==n}).join("_");var p=f.shift()[0],m=R(f.map(function(e){var n=e[0];return e[1],n}).reduce(function(e,n){return e.concat(n)},[]));return[F(p+"."+u+"(",m,")"),c]}var d=R(f.map(function(e){var n=e[0];return e[1],n}).reduce(function(e,n){return e.concat(n)},[]));return[F(u+"(",d,")"),c]}function B(e,n){for(var r=[],t={},i=0;i<Math.max(e.length,n.length);i++){var a=void 0;if(e[i])a=e[i],t[I(a.name)]=!0;else{var o=I((a=n[i]).name);t[o]&&(o=pxtc.decompiler.getNewName(o,t),a=Object.assign({altName:o},n[i]))}r.push(a)}return ts.createNodeArray(r,!1)}function G(e,n,r,t){if(!ts.isBlock(e.body)){var i=Q(e.body),a=i[0],o=i[1];if(0===o.length){var s=r?B(e.parameters,r):e.parameters,u=s.map(function(e){return A(e,!1)}).join(", "),l=u.length?"lambda "+u+": "+L(a):"lambda: "+L(a);return K(l)}}var f,c=e.name?I(e.name):("string"!=typeof(f=n||"my_function")&&(f=I(f)),m[f]?pxtc.decompiler.getNewName(f,m):(m[f]=!0,f)),p=U(e,c,r,t);return K(c,p)}function z(e){switch(e){case ts.SyntaxKind.ExclamationToken:return" ";case ts.SyntaxKind.PlusToken:case ts.SyntaxKind.MinusToken:return"";default:return" "}}function Q(e){if(ts.isBinaryExpression(e))return function(e){var n=_(e.left),r=_(e.right),t=e.operatorToken.kind===ts.SyntaxKind.PlusToken&&(n||r),i=Q(e.left),a=i[0],o=i[1];t&&!n&&(a=F("str(",a,")"));var s=D(e.operatorToken.kind,e),u=Q(e.right),l=u[0],f=u[1];t&&!r&&(l=F("str(",l,")"));var c=o.concat(f);return[F(L(a)+" "+s+" ",l),c]}(e);if(ts.isPropertyAccessExpression(e))return function(e){var n=P(e);if(n)return K(n);var r=Q(e.expression),t=r[0],i=r[1],a=I(e.name);return K("length"===a?"len("+L(t)+")":L(t)+"."+a,i)}(e);if(ts.isCallExpression(e))return q(e);if(ts.isNewExpression(e))return q(e);if(ts.isFunctionExpression(e)||ts.isArrowFunction(e))return G(e);if(ts.isPrefixUnaryExpression(e))return r=D((n=e).operator,n),t=Q(n.operand),i=t[0],a=t[1],o=z(n.operator),K(""+r+o+L(i),a);var n,r,t,i,a,o,s,u,l,f,c,p,m,d,y,v,k,g,x,T,h,S,b,N,E,C,U,A,w;if(ts.isPostfixUnaryExpression(e))return u=D((s=e).operator,s),l=Q(s.operand),f=l[0],c=l[1],p=z(s.operator),K(""+L(f)+p+u,c);if(ts.isParenthesizedExpression(e))return m=Q(e.expression),d=m[0],y=m[1],K("("+L(d)+")",y);if(ts.isArrayLiteralExpression(e))return v=e.elements.map(Q),k=v.map(function(e){e[0];var n=e[1];return n}).reduce(function(e,n){return e.concat(n)},[]),[F("[",R(v.map(function(e){var n=e[0];return e[1],n}).reduce(function(e,n){return e.concat(n)},[])),"]"),k];if(ts.isElementAccessExpression(e))return function(e){if(!e.argumentExpression)return V(e,3015,"Unsupported: element access expression without an argument expression");var n=Q(e.expression),r=n[0],t=n[1],i=Q(e.argumentExpression),a=i[0],o=i[1],s=t.concat(o);return K(L(r)+"["+L(a)+"]",s)}(e);if(ts.isNoSubstitutionTemplateLiteral(e)||ts.isTaggedTemplateExpression(e))return function(e){if(ts.isNoSubstitutionTemplateLiteral(e))return K('"""'+e.text+'"""');var n=Q(e.tag),r=n[0],t=n[1],i=Q(e.template),a=i[0],o=i[1],s=t.concat(o);return K(L(r)+"("+L(a)+")",s)}(e);switch(e.kind){case ts.SyntaxKind.TrueKeyword:return K("True");case ts.SyntaxKind.FalseKeyword:return K("False");case ts.SyntaxKind.ThisKeyword:return K("self");case ts.SyntaxKind.NullKeyword:case ts.SyntaxKind.UndefinedKeyword:return K("None")}return ts.isIdentifier(e)?"undefined"==(g=e).text?K("None"):K(I(g)):ts.isNumericLiteral(e)||ts.isStringLiteral(e)?K(e.getText()):ts.isConditionalExpression(e)?(T=Q((x=e).condition),h=T[0],S=T[1],b=Q(x.whenTrue),N=b[0],E=b[1],C=Q(x.whenFalse),U=C[0],A=C[1],w=S.concat(E).concat(A),K(N+" if "+L(h)+" else "+L(U),w)):K(e.getText(),["# unknown expression:  "+e.kind])}}(e,n),i=n.replace(/(\.py)?\.\w*$/i,"")+".py";r.outfiles[i]=t}catch(e){e.pyDiagnostic?r.diagnostics=[e.pyDiagnostic]:W.reportException(e),r.success=!1}return r},j.INDENT="    ",j.indent=e,j.indent1=e(1)}(W.py||(W.py={}))}(pxt||(pxt={})),function(e){var n,r,t;n=e.py||(e.py={}),r=n.rx||(n.rx={}),t=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,r.isIdentifierStart=function(e){return ts.pxtc.isIdentifierStart(e,ts.pxtc.ScriptTarget.ES5)},r.isIdentifierChar=function(e){return ts.pxtc.isIdentifierPart(e,ts.pxtc.ScriptTarget.ES5)},r.isSpace=function(e){return!!(32===e||9===e||11===e||12===e||160===e||5760<=e&&t.test(String.fromCharCode(e)))},r.isNewline=function(e){return 10===e||13===e||8232===e||8233===e}}(pxt||(pxt={})),function(e){!function(s){function t(e){var v={refs:[],children:[],owner:void 0};return function n(e){var r;if(!e)return v;if(ts.isPropertyAccessOrQualifiedName(e))return v;if(ts.isIdentifier(e))return{refs:[{kind:"read",node:e,varName:e.text}],children:[],owner:void 0};if(ts.isVariableDeclaration(e)||ts.isParameter(e)){var t=n(e.initializer);return{refs:__spreadArrays(t.refs,[{kind:"decl",node:e,varName:e.name.getText()}]),children:t.children,owner:void 0}}if(ts.isPrefixUnaryExpression(e)||ts.isPostfixUnaryExpression(e)){var i=n(e.operand),a=e.operand.getText(),o={refs:[{kind:"assign",node:e,varName:a}],children:[],owner:void 0};return k(i,o)}if(l=e,f=[ts.SyntaxKind.EqualsToken,ts.SyntaxKind.PlusEqualsToken,ts.SyntaxKind.MinusEqualsToken,ts.SyntaxKind.AsteriskEqualsToken,ts.SyntaxKind.AsteriskAsteriskEqualsToken,ts.SyntaxKind.SlashEqualsToken,ts.SyntaxKind.PercentEqualsToken,ts.SyntaxKind.LessThanLessThanEqualsToken,ts.SyntaxKind.GreaterThanGreaterThanEqualsToken,ts.SyntaxKind.GreaterThanGreaterThanGreaterThanEqualsToken,ts.SyntaxKind.AmpersandEqualsToken,ts.SyntaxKind.BarEqualsToken,ts.SyntaxKind.CaretEqualsToken],ts.isBinaryExpression(l)&&f.some(function(e){return l.operatorToken.kind===e})){var s=n(e.right),u=void 0;e.operatorToken.kind!==ts.SyntaxKind.EqualsToken&&(u=n(e.left));var a=e.left.getText(),o={refs:[{kind:"assign",node:e,varName:a}],children:[],owner:void 0};return k(u,k(s,o))}var l,f;if(ts.isFunctionExpression(e)||ts.isArrowFunction(e)||ts.isFunctionDeclaration(e)||ts.isMethodDeclaration(e)){var c=null===(r=e.name)||void 0===r?void 0:r.getText(),p=void 0;c&&(p={kind:"decl",node:e,varName:c});var m=e.parameters.map(function(e){return n(e)}).reduce(k,v),d=n(e.body),y=k(m,d);return y.owner=e,{refs:p?[p]:[],children:[y],owner:void 0}}return e.getChildren().map(n).reduce(k,v)}(e);function k(e,n){return e&&n?{refs:__spreadArrays(e.refs,n.refs),children:__spreadArrays(e.children,n.children),owner:e.owner||n.owner}:e||n||v}}function d(e,n,r){void 0===r&&(r=[]);for(var t=[],i=[],a=[],o=[],s={},u=0,l=e.refs;u<l.length;u++){var f=l[u];"read"===f.kind||"assign"===f.kind?s[f.varName]?a.push(f):m(f)?i.push(f):n&&n[f.varName]?t.push(f):o.push(f):s[f.varName]=f}var c=n||s,p=n?__spreadArrays(r,[s]):[];return{globalUsage:t,nonlocalUsage:i,localUsage:a,environmentUsage:o,children:e.children.map(function(e){return d(e,c,p)}),owner:e.owner};function m(n){return r.map(function(e){return e[n.varName]}).reduce(function(e,n){return n||e},void 0)}}function u(e){return e.kind+":"+e.varName}s.computeScopeVariableLookup=function(e){var n=d(t(e)),a=new Map,o=new Map;return function e(n){var r,t=s(__spreadArrays((r=n).globalUsage,r.environmentUsage).filter(function(e){return"assign"===e.kind}).map(function(e){return e}));a.set(n.owner,t);var i=s(n.nonlocalUsage.filter(function(e){return"assign"===e.kind}).map(function(e){return e}));o.set(n.owner,i),n.children.forEach(e)}(n),{getExplicitGlobals:function(e){return a.get(e)||[]},getExplicitNonlocals:function(e){return o.get(e)||[]}};function r(e){var n=e.node.operand||e.node.left;return ts.isIdentifier(n)?n:void 0}function s(e){return e.map(r).filter(function(e){return!!e}).map(function(e){return e}).reduce(function(e,n){return e.find(function(e){return e.text===n.text})?e:__spreadArrays(e,[n])},[])}},s.toStringVariableScopes=function(e){var n=t(e),r=d(n);return function e(n){var r=n.refs.map(u).join(", "),t=n.children.map(e).map(function(e){return e.map(s.indent1)}).map(function(e){return __spreadArrays(["{"],e,["}"])}).reduce(function(e,n){return __spreadArrays(e,n)},[]);return __spreadArrays([r],t)}(n).join("\n")+"\n\n\n"+function e(n){var r=n.globalUsage.map(u).join(", "),t=n.nonlocalUsage.map(u).join(", "),i=n.localUsage.map(u).join(", "),a=n.environmentUsage.map(u).join(", "),o=n.children.map(e).map(function(e){return e.map(s.indent1)}).map(function(e){return __spreadArrays(["{"],e,["}"])}).reduce(function(e,n){return __spreadArrays(e,n)},[]);return __spreadArrays([r?"global "+r:"",t?"nonlocal "+t:"",i?"local "+i:"",a?"env "+a:""],o).filter(function(e){return!!e})}(r).join("\n")}}(e.py||(e.py={}))}(pxt||(pxt={}));